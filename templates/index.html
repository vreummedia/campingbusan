<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부산 캠핑장 정보</title>
    <style>
        .price-chip{
          display:inline-block;
          width:16px; height:16px;
          border-radius:4px;
          border:1px solid rgba(0,0,0,.1);
          vertical-align:middle;
        }
        .price-chip--empty{
          background: #e9ecef;
        }
        /* 공통: 모바일/태블릿은 가로폭 꽉 차게 */
        .camp-map { margin: 6px 0 10px; }
        .camp-map img {
          display: block;
          width: 100%;
          height: auto;            /* 세로 비율 유지 */
          margin: 0 auto;          /* 중앙 정렬 */
          border-radius: 12px;
          border: 1px solid #ddd;
          background: #f8f8f8;
          /* object-fit: contain;   필요 없다면 생략, cover 쓰지 마세요 (자름) */
        }
        /* 데스크톱(넓은 화면)에서는 절반 크기 + 가운데 정렬 */
        @media (min-width: 992px) {
          .camp-map img {
            width: 50%;           /* 컨텐츠 폭의 절반 */
            max-width: 900px;     /* 너무 큰 모니터에서 과도하게 커지지 않도록 상한선 */
          }
        }
        /* 요금표 */
        .price-wrap {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0 16px;
        }
        .price-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }
        .price-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        .price-table th, .price-table td {
            border: 1px solid #eee;
            padding: 8px 10px;
            text-align: center;
        }
        .price-table th {
            background: #f1f3f5;
            font-weight: 700;
            color: #333;
        }
        .price-note {
            margin-top: 8px;
            color: #495057;
            font-size: 14px;
        }

        /* 기본 스타일 */
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        .camp-section { border: 1px solid #ddd; padding: 20px; margin-bottom: 25px; border-radius: 12px; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .camp-title { font-size: 28px; color: #333; margin-bottom: 15px; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        
        /* 날짜 선택기 */
        .date-selector { 
            margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; 
            background-color: #e9ecef; display: flex; align-items: center; flex-wrap: wrap;
        }
        .date-selector label { font-weight: bold; margin-right: 10px; color: #333; }
        .date-selector input[type="date"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin: 0 5px; }
        .date-selector button { 
            padding: 8px 15px; background-color: #007bff; color: white; border: none; 
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 5px; 
        }
        .date-selector .today-button { background-color: #28a745; }
        .date-selector .reserve-button { background-color: #ffc107; color: #212529; font-weight: bold; margin-left: 10px; }
        .date-selector .nav-button { padding: 8px 10px; font-size: 16px; background-color: #6c757d; color: white; margin: 0; line-height: 1; }
        .date-selector .nav-button:hover { background-color: #5a6268; }
        
        /* 탭 */
        .camp-tabs { display: flex; justify-content: flex-start; margin: 20px 0; border-bottom: 2px solid #ccc; flex-wrap: wrap; }
        .camp-tab { padding: 10px 15px; cursor: pointer; font-size: 18px; font-weight: bold; color: #6c757d; border: none; background-color: transparent; border-bottom: 2px solid transparent; transition: all 0.2s; margin-right: 5px; }
        .camp-tab:hover { color: #007bff; }
        .camp-tab.active { color: #007bff; border-bottom: 2px solid #007bff; background-color: #e9ecef; border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .camp-tab.disabled { color:#aaa; cursor:not-allowed; opacity:.6; }
        
        /* 삼락 A/B 테이블 */
        .area-map-container { display: flex; justify-content: space-around; flex-wrap: nowrap; margin-bottom: 20px; width: 100%; }
        .area-map-container > div { width: 50%; padding: 0 10px; box-sizing: border-box; text-align: center; }
        .area-table-a, .area-table-b { border-collapse: collapse; margin: 10px auto; width: 100%; max-width: 550px; }
        
        /* === 삼락 A/B 표 반응형 === */
        .table-wrap {
          width: 100%;
          overflow-x: auto;            /* 아주 작은 화면에서 마지막 안전장치 */
          -webkit-overflow-scrolling: touch;
        }

        .area-table-a,
        .area-table-b {
          width: 100%;                 /* 컨테이너 폭에 딱 맞게 */
          max-width: 100%;             /* 더 커지지 않게 */
          table-layout: fixed;         /* 칸을 균등 분배해서 줄임 */
          font-size: clamp(11px, 2.6vw, 16px);  /* 화면에 따라 글자 크기도 유연하게 */
        }

        .area-table-a td,
        .area-table-b td {
          min-width: 0;                /* 40px 고정 폭 제거 */
          height: auto;                /* 고정 높이 제거(내용에 맞춰) */
          padding: 8px 6px;            /* 기본 패딩 조금 줄이기 */
          box-sizing: border-box;
        }

        /* 좁은 폰에서 한 번 더 압축 */
        @media (max-width: 420px) {
          .area-table-a td,
          .area-table-b td {
            padding: 6px 4px;
          }
          .area-table-a,
          .area-table-b {
            font-size: clamp(10px, 3.2vw, 14px);
          }
        }
        
        .status-on { background-color: #28a745; color: white; font-weight: bold; }
        .status-off { background-color: #e9ecef; color: black; }
        .status-booked { background-color: #dc3545; color: white; font-weight: bold; }

        /* 나열형 박스 (대저/영도/구덕/부산항 등 공용) */
        .area-container { margin-top: 0 !important; margin-bottom: 0 !important; padding-top: 0 !important; padding-bottom: 0 !important; }
        .area-container + .area-container { margin-top: 5px; }
        .area-container h3 { margin-bottom: 5px; padding-bottom: 0; }
        .site-list { display: flex; flex-wrap: wrap; justify-content: flex-start; margin-top: 15px; max-width: 100%; font-size: 0; }
        .site-item { background-color: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 5px; margin: 4px; width: 45px; height: 45px; line-height: 35px; text-align: center; color: black; font-size: 16px; font-weight: bold; }
        .site-item.text-available { background-color: #e6ffe6; color: #008000; border-color: #008000; }
        .site-item.text-unavailable { background-color: #ffe6e6; color: #ff0000; border-color: #ff0000; }

        @media (max-width: 768px) {
          .price-table th, .price-table td { padding: 8px 6px; font-size: 14px; }
          .camp-map img { max-height: 260px; }

          .area-map-container {
            flex-direction: column;
            align-items: stretch;
          }
          .area-map-container > div {
            width: 100%;
            max-width: none;
            padding: 0;
            margin-bottom: 20px;
          }
          .area-table-a, .area-table-b {
            width: 100%;
            max-width: 100%;
          }
        }
        /* 후원 섹션 */
        .donate-wrap { margin: 18px 0 28px; }
        .donate-card {
          background: #fff; border: 1px solid #e9ecef; border-radius: 14px;
          padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,.06);
        }
        .donate-title { margin: 0 0 6px; font-size: 22px; color: #222; }
        .donate-desc { margin: 0 0 12px; color: #495057; line-height: 1.6; }
        .donate-actions { margin: 8px 0 14px; }
        .donate-button {
          display: inline-block; padding: 10px 14px; border-radius: 8px;
          background: #f7e317; color: #111; font-weight: 800; text-decoration: none;
          border: 1px solid rgba(0,0,0,.08);
        }
        .donate-button:hover { filter: brightness(.98); }

        .donate-qr { margin-top: 12px; text-align: center; }
        .donate-qr img {
          width: 180px; height: 180px; object-fit: contain; border-radius: 10px;
          border: 1px solid #eee; background: #fff;
        }
        .donate-qr-caption { font-size: 13px; color:#666; margin-top: 6px; }

        .donate-note {
          margin-top: 12px; font-size: 13px; color: #6c757d; line-height: 1.6;
        }

        /* 모바일 최적화 */
        @media (max-width: 480px) {
          .donate-qr img { width: 160px; height: 160px; }
        }
        /* PC 기본: 왼쪽 정렬 */
        .donate-actions,
        .donate-qr {
          text-align: left;
        }

        /* 모바일(태블릿 포함)에서는 가운데 정렬 */
        @media (max-width: 768px) {
          .donate-actions,
          .donate-qr {
            text-align: center;
          }
          /* 버튼/이미지가 중앙에 예쁘게 오도록 보정 */
          .donate-button {
            margin-left: auto;
            margin-right: auto;
            display: inline-block;
          }
          .donate-qr img {
            display: block;
            margin-left: auto;
            margin-right: auto;
          }
        }
                             
        .kakao_ad_area {
          margin: 12px 0;
        }

        /* --- footer --- */
        .footer {
          margin-top: 28px;
          padding: 16px 12px;
          color: #6c757d;
          font-size: 14px;
          text-align: center;
          border-top: 1px solid #e9ecef;
          background: #fafafa;
        }
        /* 전체 요약 표 - 열 너비 균일 + 비고 좁게 */
        .all-table{
          width:100%;
          border-collapse:collapse;
          table-layout:fixed;            /* colgroup 비율 강제 */
          font-size:14px;
        }
        .all-table th, .all-table td{
          border:1px solid #eee;
          padding:8px 10px;
          text-align:center;
          white-space:normal;      /* 줄바꿈 허용 */
          overflow:visible;        /* 잘라내지 않음 */
          text-overflow:clip;      /* 말줄임 해제 */
          word-break:keep-all;     /* 한글 단어 단위 유지(필요시) */
        }
        @media (max-width:480px){
          .all-table{ font-size:12px; }   /* 모바일에서 글자 조금 줄임 */
          .all-table th, .all-table td{ padding:6px 6px; }
        }

        .all-table th{ background:#f1f3f5; }

        /* 캠핑장 그룹 시작줄 굵은 선 */
        .all-table tr.tr-camp-start td,
        .all-table tr.tr-camp-start th{
          border-top:2px solid #ced4da;
        }

        @media (max-width:768px){
          .all-table th, .all-table td{ padding:6px 6px; font-size:13px; }
        }

    </style>
    <meta name="google-site-verification" content="r6BBlVSrE5T-k4aFvX0dui_od-N5x6ENGlM2zXPoBHk" />
</head>
<body>
    <h1>부산 캠핑장 실시간 예약 정보</h1>
    <form class="date-selector" id="dateForm" method="POST" action="{{ url_for('home') }}">
        <label for="resdate">예약 조회 날짜:</label>
        <button type="button" class="nav-button" onclick="moveDate(-1)">◀</button>
        <input type="date" id="resdate" name="resdate" value="{{ selected_date }}">
        <button type="button" class="nav-button" onclick="moveDate(1)">▶</button>
        <button type="submit">조회</button>
        <button type="button" class="today-button" onclick="setTodayAndSubmit()">오늘</button>
        <button type="button" class="reserve-button" onclick="openReservationLink()">예약</button>
        <input type="hidden" id="campTabInput" name="camp_tab" value="{{ selected_camp_key }}">
    </form>
    
    <p style="font-size: 1.1em; font-weight: bold;">현재 조회 날짜: <span style="color: #007bff;">{{ selected_date }}</span></p>

    <div class="camp-tabs">
    {% for key, camp in camp_tabs.items() %}
        <button 
          class="camp-tab {% if key == selected_camp_key %}active{% endif %}" 
          onclick="switchCamp('{{ key }}')">
          {{ camp.name }}
        </button>
    {% endfor %}
    </div>
    {% if selected_camp_key == 'all' %}

    {% macro price_of(camp, label_contains, colname) -%}
      {% set pt = camp.media.price_table if camp.media and camp.media.price_table else None %}
      {% if pt and pt.rows %}
        {% set ns = namespace(val='—', found=false) %}
        {% for r in pt.rows %}
          {% if not ns.found and (label_contains in (r.label or '')) %}
            {% set ns.val = r.cols.get(colname, '—') %}
            {% set ns.found = true %}
          {% endif %}
        {% endfor %}
        {{ ns.val }}
      {% else %}—{% endif %}
    {%- endmacro %}

    <table class="all-table">
      <colgroup>
        <col style="width:14%;">
        <col style="width:14%;">
        <col style="width:18%;">
        <col style="width:18%;">
        <col style="width:18%;">
        <col style="width:18%;">
      </colgroup>
      <thead>
        <tr>
          <th>캠핑장</th>
          <th>구역/타입</th>
          <th>평일</th>
          <th>주말</th>
          <th>잔여/총</th>
          <th>비고</th>
        </tr>
      </thead>
    <tbody>
    {% for camp in all_camps %}

      {% if camp.name == '삼락' %}
        {% set rows = [
          {'label':'오토 A','key':'area_a','weekday': price_of(camp,'오토 캠핑','평일'),'weekend': price_of(camp,'오토 캠핑','주말'),'total':36},
          {'label':'오토 B','key':'area_b','weekday': price_of(camp,'오토 캠핑','평일'),'weekend': price_of(camp,'오토 캠핑','주말'),'total':31},
          {'label':'일반 C','key':'area_c','weekday': price_of(camp,'일반 캠핑','평일'),'weekend': price_of(camp,'일반 캠핑','주말'),'total':50},
        ] %}
        {% for r in rows %}
          <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
            {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
            <td>{{ r.label }}</td>

            {# 오토 A/B는 동일가 → A행에서만 평/주 rowspan=2 #}
            {% if r.key in ['area_a','area_b'] %}
              {% if r.key == 'area_a' %}
                <td rowspan="2">{{ r.weekday }}</td>
                <td rowspan="2">{{ r.weekend }}</td>
              {% endif %}
            {% else %}
              <td>{{ r.weekday }}</td>
              <td>{{ r.weekend }}</td>
            {% endif %}

            <td>{{ (camp.areas.get(r.key, {}).num_available or 0) }} / {{ r.total }}</td>
            <td></td>
          </tr>
        {% endfor %}

      {% elif camp.name == '대저' %}
        {% set rows = [
          {'label':'A구역 (5x8)','key':'area_a','weekday': price_of(camp,'A구역','평일'),'weekend': price_of(camp,'A구역','주말'),'total':36},
          {'label':'B구역 (12x12)','key':'area_b','weekday': price_of(camp,'B구역','평일'),'weekend': price_of(camp,'B구역','주말'),'total':7},
          {'label':'C구역 (10x12)','key':'area_c','weekday': price_of(camp,'C구역','평일'),'weekend': price_of(camp,'C구역','주말'),'total':16},
          {'label':'D구역 (10x10)','key':'area_d','weekday': price_of(camp,'D구역','평일'),'weekend': price_of(camp,'D구역','주말'),'total':52},
        ] %}
        {% for r in rows %}
          <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
            {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
            <td>{{ r.label }}</td>
            <td>{{ r.weekday }}</td>
            <td>{{ r.weekend }}</td>
            <td>{{ (camp.areas.get(r.key, {}).num_available or 0) }} / {{ r.total }}</td>
            <td></td>
          </tr>
        {% endfor %}

      {% elif camp.name == '화명' %}
        {% set wk = price_of(camp,'전 구역','평일') %}
        {% set we = price_of(camp,'전 구역','주말') %}
        {% set defs = {'area_a':'A구역','area_b':'B구역','area_c':'C구역','area_d':'D구역','area_e':'E구역'} %}
        {% set keys = ['area_a','area_b','area_c','area_d','area_e'] %}
        {% set rows = [] %}
        {% for k in keys %}
          {% set a = camp.areas.get(k, {}) %}
          {% set total = (a.max_site_num if k in ['area_a','area_b','area_c'] else (a.available|length + a.unavailable|length)) %}
          {% set _ = rows.append({'label': defs[k], 'key': k, 'total': total}) %}
        {% endfor %}
        {% for r in rows %}
          <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
            {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
            <td>{{ r.label }}</td>

            {# A~E 동일가 → 첫 행에서만 평/주 rowspan으로 출력 #}
            {% if loop.first %}
              <td rowspan="{{ rows|length }}">{{ wk }}</td>
              <td rowspan="{{ rows|length }}">{{ we }}</td>
            {% endif %}

            <td>{{ (camp.areas.get(r.key, {}).num_available or 0) }} / {{ r.total }}</td>
            <td></td>
          </tr>
        {% endfor %}

      {% elif camp.name == '영도' %}
        {% set rows = [
          {'label':'카라반 (6인용)','key':'caravan6','weekday': price_of(camp,'카라반 (6인용)','평일'),'weekend': price_of(camp,'카라반 (6인용)','주말'),'total':15,'note': price_of(camp,'카라반 (6인용)','성수기') ~ ' (성수기: 7~8월)'},
          {'label':'카라반 (4인용)','key':'caravan4','weekday': price_of(camp,'카라반 (4인용)','평일'),'weekend': price_of(camp,'카라반 (4인용)','주말'),'total':15,'note': price_of(camp,'카라반 (4인용)','성수기') ~ ' (성수기: 7~8월)'},
          {'label':'오토','key':'auto','weekday': price_of(camp,'오토','평일'),'weekend': price_of(camp,'오토','주말'),'total':40,'note': price_of(camp,'오토','성수기') ~ ' (성수기: 7~8월)'},
          {'label':'일반','key':'general','weekday': price_of(camp,'일반','평일'),'weekend': price_of(camp,'일반','주말'),'total':12,'note': price_of(camp,'일반','성수기') ~ ' (성수기: 7~8월)'}
        ] %}
        {% for r in rows %}
          <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
            {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
            <td>{{ r.label }}</td>
            <td>{{ r.weekday }}</td>
            <td>{{ r.weekend }}</td>
            <td>
              <span id="yeongdo-all-{{ r.key }}-remain">0</span> / {{ r.total }}
            </td>
            <td>{{ r.note }}</td>
          </tr>
        {% endfor %}

      {% elif camp.name == '부산항' %}
        {# 평/주 동일가 → 두 칸(colspan=2)로 병합 #}
        {% set rows = [
          {'label':'오토','price':'30,000원','total':16,'note':'인터파크에서 확인'},
          {'label':'데크','price':'25,000원','total':24,'note':'인터파크에서 확인'}
        ] %}
        {% for r in rows %}
          <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
            {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
            <td>{{ r.label }}</td>

            {# 평일/주말 열(2개)을 하나로 합침 #}
            <td colspan="2">{{ r.price }}</td>

            <td>0 / {{ r.total }}</td>
            {% if loop.first %}<td rowspan="{{ rows|length }}">{{ r.note }}</td>{% endif %}
          </tr>
        {% endfor %}

      {% elif camp.name == '구덕' %}
        {% set area = camp.areas.get('deck', {}) %}
        {% set avail = (area.available or []) | map('string') | map('trim') | list %}
        {% set unavail = (area.unavailable or []) | map('string') | map('trim') | list %}
        {% set groups = [
          ('1 야영장',['1-1','1-2']),
          ('2 야영장',['2-1','2-2','2-3','2-4']),
          ('3 야영장',['3-1','3-2','3-3']),
          ('4 야영장',['4-1','4-2','4-3']),
          ('5 야영장',['5-1','5-2','5-3','5-4']),
          ('6 야영장',['6-1','6-2'])
        ] %}
        {% set total_all = 0 %}
        {% for _lbl, _ids in groups %}{% set total_all = total_all + (_ids|length) %}{% endfor %}
        {% set sum_avail = area.num_available or 0 %}
        {% set has_lists = (avail|length + unavail|length) > 0 %}
        {% set treat_all_free = (not has_lists) and (sum_avail == total_all) %}

        {% for label, ids in groups %}
          {% if has_lists %}
            {% set ns = namespace(av=0) %}
            {% for sid in ids %}
              {% set sid_norm = sid|string|trim %}
              {% if sid_norm in avail %}{% set ns.av = ns.av + 1 %}{% endif %}
            {% endfor %}
            {% set av_cnt = ns.av %}
          {% elif treat_all_free %}
            {% set av_cnt = ids|length %}
          {% else %}
            {% set av_cnt = None %}
          {% endif %}

          <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
            {% if loop.first %}<td rowspan="{{ groups|length }}">{{ camp.name }}</td>{% endif %}
            <td>{{ label }}</td>

            {# 평/주 2칸을 합쳐(colspan=2) + 1~6 전체를 rowspan으로 묶기 #}
            {% if loop.first %}
              <td colspan="2" rowspan="{{ groups|length }}">
                10,000원 (4인 이하) / 20,000원 (5~9인 이하)
              </td>
            {% endif %}

            <td>
              <span id="gudeok-all-{{ loop.index }}-remain">{{ (av_cnt if av_cnt is not none else '—') }}</span>
              / {{ ids|length }}
            </td>
            {% if loop.first %}<td rowspan="{{ groups|length }}">평일/주말 비용 동일</td>{% endif %}
          </tr>
        {% endfor %}

      {% endif %}

    {% endfor %}
    </tbody>

    </table>
    <div id="yeongdo-hint-all" style="margin:8px 0; color:#6c757d;"></div>
    <div id="gudeok-hint-all" style="margin:4px 0; color:#6c757d;"></div>

    {% else %}

    {% for camp in all_camps %}
      <div class="camp-section">
        {# --- 지도 + 요금표 --- #}
        {% if camp.media is defined %}
          {% if camp.media.image_url %}
            <div class="camp-map">
              <img src="{{ camp.media.image_url }}" alt="{{ camp.name }} 지도">
            </div>
          {% endif %}

          {% if camp.media.price_table and camp.media.price_table.rows %}
            <div class="price-wrap">
              <div class="price-title">요금 안내</div>
              <table class="price-table">
                <thead>
                  <tr>
                    <th style="width:36px;"></th>
                    <th>구분</th>
                    {% for col in camp.media.price_table.columns %}
                      <th>{{ col }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% for row in camp.media.price_table.rows %}
                  <tr>
                    <td>
                      <span class="price-chip {{ '' if row.color else 'price-chip--empty' }}"
                            style="{{ 'background: ' ~ row.color ~ ';' if row.color }}"></span>
                    </td>
                    <td>{{ row.label }}</td>
                    {% for col in camp.media.price_table.columns %}
                      <td>{{ row.cols.get(col, '—') }}</td>
                    {% endfor %}
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

              {% if camp.media.price_note %}
                <div class="price-note">{{ camp.media.price_note }}</div>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}

        <h2 class="camp-title">{{ camp.name }} 캠핑장</h2>

        {# 에러면 메시지만 보여주고, 아니면 아래 탭별 디스플레이 #}
        {% if camp.error %}
          <p style="color: red;">{{ camp.error }}</p>
        {% else %}

          {% if selected_camp_key == 'samnak' %}
            {# ---- 삼락 ---- #}
            {% set total_a = 36 %}{% set total_b = 31 %}{% set total_c = 50 %}
            {% set available_a = camp.areas['area_a'].num_available %}
            {% set available_b = camp.areas['area_b'].num_available %}
            {% set available_c = camp.areas['area_c'].num_available %}
            <div class="area-map-container">
              <div>
                <h3>오토 캠핑 SITE A (잔여: {{ available_a }}개 / {{ total_a }}개)</h3>
                <div class="table-wrap">
                  <table class="area-table-a">
                    {% set rows = [
                      ['빈','07','06','05','04','03','02','01'],
                      ['08','빈','27','26','25','24','23','빈'],
                      ['09','28','빈','빈','빈','빈','빈','22'],
                      ['10','29','빈','빈','빈','빈','빈','21'],
                      ['11','30','빈','빈','빈','빈','빈','20'],
                      ['12','31','빈','빈','빈','빈','빈','19'],
                      ['13','빈','14','15','16','17','18','빈']
                    ] %}
                    {% for row in rows %}
                      <tr>
                        {% for site_num in row %}
                          {% if site_num == '빈' %}
                            <td></td>
                          {% else %}
                            <td class="{% if site_num in camp.areas['area_a'].available %}status-on{% elif site_num in camp.areas['area_a'].unavailable %}status-booked{% else %}status-off{% endif %}">{{ site_num }}</td>
                          {% endif %}
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </table>
                </div>
              </div>
              <div>
                <h3>오토 캠핑 SITE B (잔여: {{ available_b }}개 / {{ total_b }}개)</h3>
                <div class="table-wrap">
                  <table class="area-table-b">
                    {% set rows = [
                      ['01','02','03','04','05','06','07','빈'],
                      ['빈','23','24','25','26','27','빈','08'],
                      ['22','빈','빈','빈','빈','빈','28','09'],
                      ['21','빈','빈','빈','빈','빈','29','10'],
                      ['20','빈','빈','빈','빈','빈','30','11'],
                      ['19','빈','빈','빈','빈','빈','31','12'],
                      ['빈','18','17','16','15','14','빈','13']
                    ] %}
                    {% for row in rows %}
                      <tr>
                        {% for site_num in row %}
                          {% if site_num == '빈' %}
                            <td></td>
                          {% else %}
                            <td class="{% if site_num in camp.areas['area_b'].available %}status-on{% elif site_num in camp.areas['area_b'].unavailable %}status-booked{% else %}status-off{% endif %}">{{ site_num }}</td>
                          {% endif %}
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </table>
                </div>
              </div>
            </div>

            <div class="camp-area">
              <h3>일반 캠핑 SITE C (잔여: {{ available_c }}개 / {{ total_c }}개)</h3>
              <div class="site-list">
                {% for i in range(1, 51) %}
                  {% set site_num = "%02d"|format(i) %}
                  {% set status_class = "text-available" if site_num in camp.areas['area_c'].available else ("text-unavailable" if site_num in camp.areas['area_c'].unavailable else "") %}
                  <div class="site-item {{ status_class }}">{{ site_num }}</div>
                {% endfor %}
              </div>
            </div>

          {% elif selected_camp_key == 'daejeo' %}
            {# ---- 대저 ---- #}
            {% set area_definitions = {
              'area_a': {'name':'A구역','size':'5x8','total':36},
              'area_b': {'name':'B구역','size':'12x12','total':7},
              'area_c': {'name':'C구역','size':'10x12','total':16},
              'area_d': {'name':'D구역','size':'10x10','total':52}
            } %}
            {% for area_key, defs in area_definitions.items() %}
              {% set max_num = camp.areas[area_key].max_site_num %}
              {% set total_count = defs.total %}
              {% set available_count = camp.areas[area_key].num_available %}
              {% set zero_padding = 2 if max_num < 100 else 3 %}
              <div class="area-container">
                <h3 class="area-title">{{ defs.name }} ({{ defs.size }}) (잔여: {{ available_count }}개 / {{ total_count }}개)</h3>
                <div class="site-list">
                  {% for i in range(1, max_num + 1) %}
                    {% set site_num = ("%0" + zero_padding|string + "d")|format(i) %}
                    {% set status_class = "text-available" if site_num in camp.areas[area_key].available else ("text-unavailable" if site_num in camp.areas[area_key].unavailable else "") %}
                    <div class="site-item {{ status_class }}">{{ site_num }}</div>
                  {% endfor %}
                  {% if max_num == 0 %}
                    <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                  {% endif %}
                </div>
              </div>
            {% endfor %}

          {% elif selected_camp_key == 'hwamyeong' %}
            {# ---- 화명 ---- #}
            {% set area_definitions = {
              'area_a': {'name':'A구역','size':'미정'},
              'area_b': {'name':'B구역','size':'미정'},
              'area_c': {'name':'C구역','size':'미정'},
              'area_d': {'name':'D구역','size':'D구역'},
              'area_e': {'name':'E구역','size':'E구역'}
            } %}
            {% set area_keys_to_show = ['area_a','area_b','area_c','area_d','area_e'] %}
            {% for area_key in area_keys_to_show %}
              {% set defs = area_definitions[area_key] %}
              {% set area_data = camp.areas[area_key] %}
              {% if area_key in ['area_d','area_e'] %}
                {% set total_count = area_data.available|length + area_data.unavailable|length %}
                {% set site_list_full_names = area_data.available + area_data.unavailable %}
              {% else %}
                {% set total_count = area_data.max_site_num %}
              {% endif %}
              {% set available_count = area_data.num_available %}
              <div class="area-container">
                <h3 class="area-title">{{ defs.name }} (잔여: {{ available_count }}개 / {{ total_count }}개)</h3>
                <div class="site-list">
                  {% if area_key in ['area_d','area_e'] %}
                    {% if site_list_full_names %}
                      {% for site_name in site_list_full_names|sort %}
                        {% set site_number_only = site_name|replace('D','')|replace('E','') %}
                        {% set site_num_to_display = "%02d"|format(site_number_only|int) %}
                        {% set status_class = "text-available" if site_name in area_data.available else ("text-unavailable" if site_name in area_data.unavailable else "") %}
                        <div class="site-item {{ status_class }}">{{ site_num_to_display }}</div>
                      {% endfor %}
                    {% else %}
                      <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                    {% endif %}
                  {% else %}
                    {% set max_num = area_data.max_site_num %}
                    {% if max_num > 0 %}
                      {% for i in range(1, max_num + 1) %}
                        {% set site_num_for_comparison = i|string %}
                        {% set site_num_to_display = "%02d"|format(i) %}
                        {% set status_class = "text-available" if site_num_for_comparison in area_data.available else ("text-unavailable" if site_num_for_comparison in area_data.unavailable else "") %}
                        <div class="site-item {{ status_class }}">{{ site_num_to_display }}</div>
                      {% endfor %}
                    {% else %}
                      <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                    {% endif %}
                  {% endif %}
                </div>
              </div>
            {% endfor %}
        {% elif selected_camp_key == 'yeongdo' %}
          {% set camp_idx = loop.index0 %}   {# ← 바깥 camp 루프의 인덱스를 저장 #}
          {% set labels = {'caravan':'카라반', 'auto':'오토', 'general':'일반'} %}

          <div id="yeongdo-container-{{ camp_idx }}">
            <p id="yeongdo-hint-{{ camp_idx }}" style="color:#6c757d">영도 데이터를 불러오는 중입니다…</p>

            {% for key in ['caravan','auto','general'] %}
              {% set area = camp.areas[key] %}
              <div class="area-container" id="yeongdo-{{ key }}-{{ camp_idx }}">  {# ← camp_idx 사용 #}
                <h3 class="area-title">
                  {{ labels[key] }} (잔여: <span class="cnt-available">0</span>개 / {{ area.total }}개)
                </h3>
                <div class="site-list"></div>
              </div>
            {% endfor %}
          </div>

          <script>
            document.addEventListener('DOMContentLoaded', function () {
              loadYeongdo('{{ selected_date }}', '-{{ camp_idx }}');   // ← camp_idx로 맞춤
            });
          </script>

          {% elif selected_camp_key == 'busan_port' %}
            {# ---- 부산항 ---- #}
            {% set labels = {'auto':'오토 사이트','deck':'데크 사이트'} %}
            {% set totals = {'auto':16,'deck':24} %}
            {% for key in ['auto','deck'] %}
              <div class="area-container">
                <h3 class="area-title">{{ labels[key] }} (총 {{ totals[key] }}개)</h3>
                <p style="color:#6c757d; font-size:14px; margin:6px 2px 0;">
                  실시간 잔여 좌석은 예약 페이지에서 확인하세요.
                </p>
              </div>
            {% endfor %}
        {% elif selected_camp_key == 'gudeok' %}
          <div id="gudeok-wrap">
            <p id="gudeok-hint" style="color:#6c757d">구덕 데이터를 불러오는 중입니다…</p>

            {% set groups = [
              {'label':'1 야영장','sites':['1-1','1-2']},
              {'label':'2 야영장','sites':['2-1','2-2','2-3','2-4']},
              {'label':'3 야영장','sites':['3-1','3-2','3-3']},
              {'label':'4 야영장','sites':['4-1','4-2','4-3']},
              {'label':'5 야영장','sites':['5-1','5-2','5-3','5-4']},
              {'label':'6 야영장','sites':['6-1','6-2']}
            ] %}

            {% for grp in groups %}
              <div class="area-container" id="gudeok-{{ loop.index0 }}">
                <h3 class="area-title">
                  {{ grp.label }} (잔여: <span class="cnt-available">0</span>개 / {{ grp.sites|length }}개)
                </h3>
                <div class="site-list" data-sites="{{ grp.sites|join(',') }}"></div>
              </div>
            {% endfor %}
          </div>

          <script>
          document.addEventListener('DOMContentLoaded', function () {
            const dateStr = '{{ selected_date }}';
            const hint = document.getElementById('gudeok-hint');

            // ① 캐시가 있으면 즉시 그려서 '빈 화면'을 없앰
            if (window.__GUDEOK_CACHE && window.__GUDEOK_CACHE[dateStr]) {
              try {
                renderGudeok(window.__GUDEOK_CACHE[dateStr]);
                if (hint) hint.textContent = '캐시로 표시 중… (서버 최신 확인 중)';
              } catch (_) {}
            } else {
              if (hint) hint.textContent = '구덕 수집 중… (0/60)';
            }

           // ② 서버 최신 확인(폴링) 시작
            loadGudeok(dateStr);
          });
          </script>



          {% else %}
            <p>표시할 캠핑장 정보가 없습니다.</p>
          {% endif %}

        {% endif %} {# camp.error else 종료 #}
      </div>
    {% endfor %}

    {% endif %} {# selected_camp_key == 'all' 종료 #}


    <script>
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0'); 
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        function setTodayAndSubmit() {
            document.getElementById('resdate').value = formatDate(new Date());
            document.getElementById('dateForm').submit();
        }
        function moveDate(dayChange) {
            const input = document.getElementById('resdate');
            const [yy, mm, dd] = input.value.split('-').map(v=>parseInt(v,10));
            const dt = new Date(yy, mm-1, dd);
            dt.setDate(dt.getDate() + dayChange);
            input.value = formatDate(dt);
            document.getElementById('dateForm').submit();
        }
        function openReservationLink() {
            const key = document.getElementById('campTabInput').value;
            const d = document.getElementById('resdate').value;
            let url_base;
            if (key === 'daejeo') {
                url_base = "https://www.daejeocamping.com/reservation/real_time?resdate=";
            } else if (key === 'hwamyeong') {
                url_base = "https://hwamyungcamping.com/reservation/real_time?resdate=";
            } else if (key === 'yeongdo') {
                window.open("https://www.yeongdo.go.kr/marinocamping/00003/00015/00028.web", "_blank"); return;
            } else if (key === 'busan_port') {
              window.open("https://www.busanpa.com/redevelopment/Board.do?mCode=MN0082", "_blank"); 
              return;
            } else if (key === 'gudeok') {
                window.open("https://gudeok.go.kr/rent_camp01.php", "_blank"); return;

            } else { // samnak 등
                url_base = "https://www.nakdongcamping.com/reservation/real_time?resdate=";
            }
            const reservationUrl = url_base + d + "&schGugun=1&price=0&bagprice=2000&allprice=0&percnt=0&g-recaptcha-response=";
            window.open(reservationUrl, '_blank');
        }
        function switchCamp(campKey) {
            document.getElementById('campTabInput').value = campKey;
            document.getElementById('dateForm').submit();
        }
    </script>

    <script>
    let YEONGDO_POLLING = null;

    // ALL 화면에서는 표 개요(잔여/총)만 쓰므로, 탭 전용 DOM이 없으면 아무 것도 안 함.
    function renderYeongdo(data, suffix) {
      // 탭 모드에서만 있는 컨테이너(예: #yeongdo-auto-0 ...)가 실제 있을 때만 렌더
      const hasTabContainer =
        document.querySelector(`[id^="yeongdo-caravan"]`) ||
        document.querySelector(`[id^="yeongdo-auto"]`) ||
        document.querySelector(`[id^="yeongdo-general"]`);

      if (!hasTabContainer) return;

      const areas = [
        { key: "caravan", label: "카라반" },
        { key: "auto",    label: "오토"    },
        { key: "general", label: "일반"    },
      ];

      areas.forEach(({ key }) => {
        const wrap = document.getElementById(`yeongdo-${key}${suffix}`);
        if (!wrap) return;

        const cntEl = wrap.querySelector(".cnt-available");
        const list  = wrap.querySelector(".site-list");
        const av    = (data?.[key]?.available || []).map(n => String(n).padStart(2, "0"));
        const un    = (data?.[key]?.unavailable || []).map(n => String(n).padStart(2, "0"));

        if (cntEl) cntEl.textContent = av.length;
        if (list) {
          list.innerHTML = "";
          const all = [...av.map(v => ({ v, cls: "text-available" })), ...un.map(v => ({ v, cls: "text-unavailable" }))];
          // 번호 오름차순 정렬
          all.sort((a, b) => parseInt(a.v, 10) - parseInt(b.v, 10));
          all.forEach(({ v, cls }) => {
            const div = document.createElement("div");
            div.className = `site-item ${cls}`;
            div.textContent = v;
            list.appendChild(div);
          });
        }
      });
    }

    // (기존) loadYeongdo/stopYeongdoPolling 그대로 유지
    </script>

    <script>

    // 영도 완료를 기다린 뒤(ready) 구덕을 시작하되,
    // 오래 걸리면 일정 시간 후 구덕을 "추가로" 시작하기 위한 지연(ms)
    const YEONGDO_GUDEOK_DELAY_MS = 120000; // ← 120초. 원하면 0~180000 등으로 조정

    function loadYeongdo(dateStr, suffix="", onGudeokKickoff=null) {
      stopYeongdoPolling();
      const maxTries = 60;
      let tries = 0;
      const url = `/api/yeongdo?date=${encodeURIComponent(dateStr)}`;
      const hint = document.getElementById(`yeongdo-hint${suffix}`) || document.getElementById('yeongdo-hint');

      // 지연 후 "구덕도 시작해!" 콜백을 불러주는 타이머 (영도 취소 X)
      let delayedKickTimer = null;
      if (typeof onGudeokKickoff === 'function' && YEONGDO_GUDEOK_DELAY_MS > 0) {
        delayedKickTimer = setTimeout(() => {
          try { onGudeokKickoff(); } catch(e){}
          // 지연 시작은 1회만
        }, YEONGDO_GUDEOK_DELAY_MS);
      }

      const tick = () => {
        fetch(url, {cache:'no-store'})
          .then(r => r.json())
          .then(json => {
            if (json.status === 'ready') {
              if (json.data && json.data.error) {
                if (hint) hint.textContent = '영도 오류: ' + json.data.error;
              } else if (hint) {
                hint.textContent = '영도 데이터를 가져왔습니다.';
              }
              renderYeongdo(json.data, suffix);
              renderYeongdoAllSummary(json.data);

              // 영도가 준비됐으면, 아직 구덕을 안 시작했다면 지금 시작하도록 콜백 호출
              if (typeof onGudeokKickoff === 'function') {
                try { onGudeokKickoff(); } catch(e){}
              }

              // 지연 타이머가 걸려 있었다면 정리
              if (delayedKickTimer) { clearTimeout(delayedKickTimer); delayedKickTimer = null; }

              stopYeongdoPolling();
            } else if (json.status === 'pending') {
              if (tries++ < maxTries) {
                if (hint) hint.textContent = `영도 수집 중… (${tries}/${maxTries})`;
                YEONGDO_POLLING = setTimeout(tick, 1000);
              } else {
                if (hint) hint.textContent = '처리가 지연되고 있어요. 계속 확인 중…';
                tries = 0;
                YEONGDO_POLLING = setTimeout(tick, 5000);
              }
            } else {
              if (hint) hint.textContent = '알 수 없는 응답입니다.';
              stopYeongdoPolling();
            }
          })
          .catch(_ => {
            if (tries++ < maxTries) {
              if (hint) hint.textContent = `재시도 중… (${tries}/${maxTries})`;
              YEONGDO_POLLING = setTimeout(tick, 1200);
            } else {
              if (hint) hint.textContent = '네트워크 오류가 발생했습니다.';
              stopYeongdoPolling();
            }
          });
      };

      tick();
    }

    function stopYeongdoPolling(){
      if (YEONGDO_POLLING) {
        clearTimeout(YEONGDO_POLLING);
        YEONGDO_POLLING = null;
      }
    }
    </script>


    <script>
    function renderYeongdoAllSummary(data){
      // caravan(공유), auto, general
      const counts = {
        caravan: (data.caravan?.available || []).length,
        auto:    (data.auto?.available    || []).length,
        general: (data.general?.available || []).length,
      };

      const map = {
        caravan6: 'yeongdo-all-caravan6-remain',
        caravan4: 'yeongdo-all-caravan4-remain',
        auto:     'yeongdo-all-auto-remain',
        general:  'yeongdo-all-general-remain',
      };

      // 카라반 6/4 둘 다 같은 잔여 수로 표기 (서버 파싱은 단일 'caravan' 그룹)
      const values = {
        caravan6: counts.caravan,
        caravan4: counts.caravan,
        auto:     counts.auto,
        general:  counts.general,
      };

      Object.keys(values).forEach(k=>{
        const el = document.getElementById(map[k]);
        if (el) el.textContent = String(values[k]);
      });
    }
    </script>
    <script>
    let GUDEOK_TAB_POLLING = null;

    function loadGudeok(dateStr){
      stopGudeokTabPolling();
      const maxTries = 60;
      let tries = 0;
      const url = `/api/gudeok?date=${encodeURIComponent(dateStr)}`;
      const hint = document.getElementById('gudeok-hint');

      if (hint) hint.textContent = `구덕 수집 중… (${tries}/${maxTries})`;

      const tick = () => {
        fetch(url, { cache: 'no-store' })
          .then(async (r) => {
            if (!r.ok) {
              const body = await r.text().catch(()=>'');
              // 디버깅 도움: 상태/일부 바디를 콘솔로
              console.warn('[gudeok] non-OK', r.status, body.slice(0,120));
              throw new Error(`HTTP ${r.status}`);
            }
            const ct = r.headers.get('content-type') || '';
            if (!ct.includes('application/json')) {
              const body = await r.text().catch(()=> '');
              console.warn('[gudeok] not JSON', ct, body.slice(0,120));
              throw new Error('Non-JSON');
            }
            return r.json();
          })
          .then((json) => {
            if (json.status === 'ready'){
              if (hint) hint.textContent = '구덕 데이터를 가져왔습니다.';
              // 성공 시 캐시에도 저장
              window.__GUDEOK_CACHE = window.__GUDEOK_CACHE || {};
              window.__GUDEOK_CACHE[dateStr] = json.data;
              renderGudeok(json.data);
              stopGudeokTabPolling();
            } else if (json.status === 'pending'){
              if (tries < maxTries){
                tries++;
                if (hint) hint.textContent = `구덕 수집 중… (${tries}/${maxTries})`;
                GUDEOK_TAB_POLLING = setTimeout(tick, 1000);
              } else {
                if (hint) hint.textContent = '처리가 지연되고 있어요. 계속 확인 중…';
                tries = 0;
                GUDEOK_TAB_POLLING = setTimeout(tick, 5000);
              }
            } else {
              if (hint) hint.textContent = '알 수 없는 응답입니다.';
              stopGudeokTabPolling();
            }
          })
          .catch((err) => {
            if (tries < maxTries){
              tries++;
              if (hint) hint.textContent = `재시도 중… (${tries}/${maxTries})`;
              GUDEOK_TAB_POLLING = setTimeout(tick, 1200);
            } else {
              if (hint) hint.textContent = '네트워크/서버 오류가 발생했습니다. (캐시가 있으면 그대로 표시됩니다)';
              stopGudeokTabPolling();
            }
          });
      };

      tick();
    }

    function stopGudeokTabPolling(){
      if (GUDEOK_TAB_POLLING){
        clearTimeout(GUDEOK_TAB_POLLING);
        GUDEOK_TAB_POLLING = null;
      }
    }
    </script>


    <script>
    document.addEventListener('DOMContentLoaded', function(){
      if ('{{ selected_camp_key }}' === 'all') {
        // 힌트(영도)
        const hintAll = document.getElementById('yeongdo-hint-all');
        if (hintAll && !document.getElementById('yeongdo-hint')) {
          const alias = document.createElement('span');
          alias.id = 'yeongdo-hint';
          hintAll.appendChild(alias);
        }
        // 힌트(구덕)
        if (!document.getElementById('gudeok-hint-all')) {
          const p = document.createElement('div');
          p.id = 'gudeok-hint-all';
          p.style.cssText = 'margin:4px 0; color:#6c757d;';
          const anchor = document.getElementById('yeongdo-hint-all') || document.body;
          anchor.insertAdjacentElement('afterend', p);
        }
        const gudeokHint = document.getElementById('gudeok-hint-all');
        if (gudeokHint) gudeokHint.textContent = '구덕 수집 중… (대기 중)';

        // 영도 시작: 준비되면 구덕 시작
        // (또는 YEONGDO_GUDEOK_DELAY_MS 후 자동으로 구덕도 시작)
        loadYeongdo('{{ selected_date }}', '', function(){
          if (gudeokHint) gudeokHint.textContent = '구덕 수집 중…';
          loadGudeokAll('{{ selected_date }}');
        });
      }
    });
    </script>



    <script>
    let GUDEOK_ALL_POLLING = null;

    function loadGudeokAll(dateStr){
      stopGudeokAllPolling();
      const url = `/api/gudeok?date=${encodeURIComponent(dateStr)}`;
      let tries = 0, maxTries = 60;

      // 힌트 엘리먼트 (없으면 생성하지 말고 조용히 패스)
      const hint = document.getElementById('gudeok-hint-all');

      const tick = () => {
        fetch(url, {cache:'no-store'})
          .then(r=>r.json())
          .then(json=>{
            if (json.status === 'ready') {
              if (hint) hint.textContent = '구덕 데이터를 가져왔습니다.';
              renderGudeokAll(json.data);
              window.__GUDEOK_CACHE = window.__GUDEOK_CACHE || {};
              window.__GUDEOK_CACHE['{{ selected_date }}'] = json.data;
              stopGudeokAllPolling();
            } else if (json.status === 'pending') {
              if (tries++ < maxTries) {
                if (hint) hint.textContent = `구덕 수집 중… (${tries}/${maxTries})`;
                GUDEOK_ALL_POLLING = setTimeout(tick, 1000);
              } else {
                if (hint) hint.textContent = '처리가 지연되고 있어요. 계속 확인 중…';
                tries = 0;
                GUDEOK_ALL_POLLING = setTimeout(tick, 5000);
              }
            } else {
              if (hint) hint.textContent = '알 수 없는 응답입니다.';
              stopGudeokAllPolling();
            }
          })
          .catch(_=>{
            if (tries++ < maxTries) {
              if (hint) hint.textContent = `재시도 중… (${tries}/${maxTries})`;
              GUDEOK_ALL_POLLING = setTimeout(tick, 1200);
            } else {
              if (hint) hint.textContent = '네트워크 오류가 발생했습니다.';
              stopGudeokAllPolling();
            }
          });
      };
      // 최초 한 번 “수집 중…” 초기화
      if (hint) hint.textContent = '구덕 수집 중… (0/60)';
      tick();
    }

    function stopGudeokAllPolling(){
      if (GUDEOK_ALL_POLLING){ clearTimeout(GUDEOK_ALL_POLLING); GUDEOK_ALL_POLLING = null; }
    }

    /* 전체 표(1~6야영장) 갱신 */
    function renderGudeokAll(data){
      const deck = (data && data.deck) ? data.deck : {available:[],unavailable:[]};

      // ID 정규화: "1-01" / "1 - 1" / "1_1" → "1-1"
      const normId = (v) => {
        if (v == null) return "";
        let s = String(v).trim();
        s = s.replace(/\s+/g, "");
        s = s.replace(/[^\d\-]/g, "-");
        const m = s.match(/(\d+)\D+(\d+)/);
        if (m) return `${parseInt(m[1],10)}-${parseInt(m[2],10)}`;
        const m2 = s.match(/^(\d+)-(\d+)$/);
        if (m2) return `${parseInt(m2[1],10)}-${parseInt(m2[2],10)}`;
        return s;
      };

      const avSet = new Set((deck.available  || []).map(normId));
      const unSet = new Set((deck.unavailable|| []).map(normId));

      const groups = [
        ['1',['1-1','1-2']],
        ['2',['2-1','2-2','2-3','2-4']],
        ['3',['3-1','3-2','3-3']],
        ['4',['4-1','4-2','4-3']],
        ['5',['5-1','5-2','5-3','5-4']],
        ['6',['6-1','6-2']],
      ];

      groups.forEach(([idx, ids])=>{
        let cnt = 0;
        ids.forEach(id => { if (avSet.has(normId(id))) cnt++; });
        const el = document.getElementById(`gudeok-all-${idx}-remain`);
        if (el) el.textContent = String(cnt);
      });
    }
    </script>

    <script>
    function renderGudeok(data){
      const deck = data?.deck || {};
      const normId = (v) => {
        if (v == null) return "";
        let s = String(v).trim();
        s = s.replace(/\s+/g, "");
        s = s.replace(/[^\d\-]/g, "-");
        const m = s.match(/(\d+)\D+(\d+)/);
        if (m) return `${parseInt(m[1],10)}-${parseInt(m[2],10)}`;
        const m2 = s.match(/^(\d+)-(\d+)$/);
        if (m2) return `${parseInt(m2[1],10)}-${parseInt(m2[2],10)}`;
        return s;
      };

      const av = (deck.available || []).map(normId);
      const un = (deck.unavailable || []).map(normId);

      document.querySelectorAll('.area-container[id^="gudeok-"]').forEach((wrap)=>{
        const listEl = wrap.querySelector('.site-list');
        const cntEl  = wrap.querySelector('.cnt-available');
        const sites  = (listEl.getAttribute('data-sites') || '').split(',').map(s=>s.trim()).filter(Boolean);

        const avCnt = sites.reduce((n, id)=> n + (av.includes(normId(id)) ? 1 : 0), 0);
        if (cntEl) cntEl.textContent = avCnt;

        listEl.innerHTML = '';
        sites.forEach(id=>{
          const isAv = av.includes(normId(id));
          const isUn = un.includes(normId(id));
          const div = document.createElement('div');
          div.className = 'site-item ' + (isAv ? 'text-available' : (isUn ? 'text-unavailable' : ''));
          div.textContent = id;
          listEl.appendChild(div);
        });
      });
    }
    </script>


    <!-- 후원하기 섹션 -->
    <section class="donate-wrap">
      <div class="donate-card">
        <h2 class="donate-title">후원하기</h2>
        <p class="donate-desc">
          도움이 되셨다면 커피 한 잔 후원해 주세요 ☕️<br>
          카카오 페이로 안전하게 송금하실 수 있어요.
        </p>
        <div class="donate-actions">
          <!-- 🔗 카카오페이 송금 링크: 실제 복사한 링크로 교체 -->
          <a class="donate-button" href="https://qr.kakaopay.com/Ej8wCmrfN" target="_blank" rel="noopener noreferrer">
            카카오 페이로 송금하기
          </a>
        </div>

        <!-- QR (데스크톱/태블릿에서 특히 유용) -->
        <div class="donate-qr">
          <img src="{{ url_for('static', filename='qrcode_donation.png') }}" alt="카카오페이 송금 QR" />
          <div class="donate-qr-caption">휴대폰 카메라로 QR을 스캔해 주세요</div>
        </div>
      </div>
    </section>
    <!-- 예: 반응형 배너 (가로 320 x 세로 100) -->
    <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit = "DAN-WPxG6Yasp5xS2m0G"
    data-ad-width = "300"
    data-ad-height = "250"></ins>
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
    <div class="footer">All rights reserved by 바름 미디어</div>
</body>
</html>

