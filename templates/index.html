<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ìº í•‘ì¥ ì •ë³´</title>
    <style>
        .price-chip{
          display:inline-block;
          width:16px; height:16px;
          border-radius:4px;
          border:1px solid rgba(0,0,0,.1);
          vertical-align:middle;
        }
        .price-chip--empty{
          background: #e9ecef;
        }
        /* ê³µí†µ: ëª¨ë°”ì¼/íƒœë¸”ë¦¿ì€ ê°€ë¡œí­ ê½‰ ì°¨ê²Œ */
        .camp-map { margin: 6px 0 10px; }
        .camp-map img {
          display: block;
          width: 100%;
          height: auto;            /* ì„¸ë¡œ ë¹„ìœ¨ ìœ ì§€ */
          margin: 0 auto;          /* ì¤‘ì•™ ì •ë ¬ */
          border-radius: 12px;
          border: 1px solid #ddd;
          background: #f8f8f8;
          /* object-fit: contain;   í•„ìš” ì—†ë‹¤ë©´ ìƒëµ, cover ì“°ì§€ ë§ˆì„¸ìš” (ìë¦„) */
        }
        /* ë°ìŠ¤í¬í†±(ë„“ì€ í™”ë©´)ì—ì„œëŠ” ì ˆë°˜ í¬ê¸° + ê°€ìš´ë° ì •ë ¬ */
        @media (min-width: 992px) {
          .camp-map img {
            width: 50%;           /* ì»¨í…ì¸  í­ì˜ ì ˆë°˜ */
            max-width: 900px;     /* ë„ˆë¬´ í° ëª¨ë‹ˆí„°ì—ì„œ ê³¼ë„í•˜ê²Œ ì»¤ì§€ì§€ ì•Šë„ë¡ ìƒí•œì„  */
          }
        }
        /* ìš”ê¸ˆí‘œ */
        .price-wrap {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0 16px;
        }
        .price-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }
        .price-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        .price-table th, .price-table td {
            border: 1px solid #eee;
            padding: 8px 10px;
            text-align: center;
        }
        .price-table th {
            background: #f1f3f5;
            font-weight: 700;
            color: #333;
        }
        .price-note {
            margin-top: 8px;
            color: #495057;
            font-size: 14px;
        }

        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        .camp-section { border: 1px solid #ddd; padding: 20px; margin-bottom: 25px; border-radius: 12px; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .camp-title { font-size: 28px; color: #333; margin-bottom: 15px; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        
        /* ë‚ ì§œ ì„ íƒê¸° */
        .date-selector { 
            margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; 
            background-color: #e9ecef; display: flex; align-items: center; flex-wrap: wrap;
        }
        .date-selector label { font-weight: bold; margin-right: 10px; color: #333; }
        .date-selector input[type="date"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin: 0 5px; }
        .date-selector button { 
            padding: 8px 15px; background-color: #007bff; color: white; border: none; 
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 5px; 
        }
        .date-selector .today-button { background-color: #28a745; }
        .date-selector .reserve-button { background-color: #ffc107; color: #212529; font-weight: bold; margin-left: 10px; }
        .date-selector .nav-button { padding: 8px 10px; font-size: 16px; background-color: #6c757d; color: white; margin: 0; line-height: 1; }
        .date-selector .nav-button:hover { background-color: #5a6268; }
        
        /* íƒ­ */
        .camp-tabs { display: flex; justify-content: flex-start; margin: 20px 0; border-bottom: 2px solid #ccc; flex-wrap: wrap; }
        .camp-tab { padding: 10px 15px; cursor: pointer; font-size: 18px; font-weight: bold; color: #6c757d; border: none; background-color: transparent; border-bottom: 2px solid transparent; transition: all 0.2s; margin-right: 5px; }
        .camp-tab:hover { color: #007bff; }
        .camp-tab.active { color: #007bff; border-bottom: 2px solid #007bff; background-color: #e9ecef; border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .camp-tab.disabled { color:#aaa; cursor:not-allowed; opacity:.6; }
        
        /* ì‚¼ë½ A/B í…Œì´ë¸” */
        .area-map-container { display: flex; justify-content: space-around; flex-wrap: nowrap; margin-bottom: 20px; width: 100%; }
        .area-map-container > div { width: 50%; padding: 0 10px; box-sizing: border-box; text-align: center; }
        .area-table-a, .area-table-b { border-collapse: collapse; margin: 10px auto; width: 100%; max-width: 550px; }
        
        /* === ì‚¼ë½ A/B í‘œ ë°˜ì‘í˜• === */
        .table-wrap {
          width: 100%;
          overflow-x: auto;            /* ì•„ì£¼ ì‘ì€ í™”ë©´ì—ì„œ ë§ˆì§€ë§‰ ì•ˆì „ì¥ì¹˜ */
          -webkit-overflow-scrolling: touch;
        }

        .area-table-a,
        .area-table-b {
          width: 100%;                 /* ì»¨í…Œì´ë„ˆ í­ì— ë”± ë§ê²Œ */
          max-width: 100%;             /* ë” ì»¤ì§€ì§€ ì•Šê²Œ */
          table-layout: fixed;         /* ì¹¸ì„ ê· ë“± ë¶„ë°°í•´ì„œ ì¤„ì„ */
          font-size: clamp(11px, 2.6vw, 16px);  /* í™”ë©´ì— ë”°ë¼ ê¸€ì í¬ê¸°ë„ ìœ ì—°í•˜ê²Œ */
        }

        .area-table-a td,
        .area-table-b td {
          min-width: 0;                /* 40px ê³ ì • í­ ì œê±° */
          height: auto;                /* ê³ ì • ë†’ì´ ì œê±°(ë‚´ìš©ì— ë§ì¶°) */
          padding: 8px 6px;            /* ê¸°ë³¸ íŒ¨ë”© ì¡°ê¸ˆ ì¤„ì´ê¸° */
          box-sizing: border-box;
        }

        /* ì¢ì€ í°ì—ì„œ í•œ ë²ˆ ë” ì••ì¶• */
        @media (max-width: 420px) {
          .area-table-a td,
          .area-table-b td {
            padding: 6px 4px;
          }
          .area-table-a,
          .area-table-b {
            font-size: clamp(10px, 3.2vw, 14px);
          }
        }
        
        .status-on { background-color: #28a745; color: white; font-weight: bold; }
        .status-off { background-color: #e9ecef; color: black; }
        .status-booked { background-color: #dc3545; color: white; font-weight: bold; }

        /* ë‚˜ì—´í˜• ë°•ìŠ¤ (ëŒ€ì €/ì˜ë„/êµ¬ë•/ë¶€ì‚°í•­ ë“± ê³µìš©) */
        .area-container { margin-top: 0 !important; margin-bottom: 0 !important; padding-top: 0 !important; padding-bottom: 0 !important; }
        .area-container + .area-container { margin-top: 5px; }
        .area-container h3 { margin-bottom: 5px; padding-bottom: 0; }
        .site-list { display: flex; flex-wrap: wrap; justify-content: flex-start; margin-top: 15px; max-width: 100%; font-size: 0; }
        .site-item { background-color: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 5px; margin: 4px; width: 45px; height: 45px; line-height: 35px; text-align: center; color: black; font-size: 16px; font-weight: bold; }
        .site-item.text-available { background-color: #e6ffe6; color: #008000; border-color: #008000; }
        .site-item.text-unavailable { background-color: #ffe6e6; color: #ff0000; border-color: #ff0000; }

        @media (max-width: 768px) {
          .price-table th, .price-table td { padding: 8px 6px; font-size: 14px; }
          .camp-map img { max-height: 260px; }

          .area-map-container {
            flex-direction: column;
            align-items: stretch;
          }
          .area-map-container > div {
            width: 100%;
            max-width: none;
            padding: 0;
            margin-bottom: 20px;
          }
          .area-table-a, .area-table-b {
            width: 100%;
            max-width: 100%;
          }
        }
        /* í›„ì› ì„¹ì…˜ */
        .donate-wrap { margin: 18px 0 28px; }
        .donate-card {
          background: #fff; border: 1px solid #e9ecef; border-radius: 14px;
          padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,.06);
        }
        .donate-title { margin: 0 0 6px; font-size: 22px; color: #222; }
        .donate-desc { margin: 0 0 12px; color: #495057; line-height: 1.6; }
        .donate-actions { margin: 8px 0 14px; }
        .donate-button {
          display: inline-block; padding: 10px 14px; border-radius: 8px;
          background: #f7e317; color: #111; font-weight: 800; text-decoration: none;
          border: 1px solid rgba(0,0,0,.08);
        }
        .donate-button:hover { filter: brightness(.98); }

        .donate-qr { margin-top: 12px; text-align: center; }
        .donate-qr img {
          width: 180px; height: 180px; object-fit: contain; border-radius: 10px;
          border: 1px solid #eee; background: #fff;
        }
        .donate-qr-caption { font-size: 13px; color:#666; margin-top: 6px; }

        .donate-note {
          margin-top: 12px; font-size: 13px; color: #6c757d; line-height: 1.6;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 480px) {
          .donate-qr img { width: 160px; height: 160px; }
        }
        /* PC ê¸°ë³¸: ì™¼ìª½ ì •ë ¬ */
        .donate-actions,
        .donate-qr {
          text-align: left;
        }

        /* ëª¨ë°”ì¼(íƒœë¸”ë¦¿ í¬í•¨)ì—ì„œëŠ” ê°€ìš´ë° ì •ë ¬ */
        @media (max-width: 768px) {
          .donate-actions,
          .donate-qr {
            text-align: center;
          }
          /* ë²„íŠ¼/ì´ë¯¸ì§€ê°€ ì¤‘ì•™ì— ì˜ˆì˜ê²Œ ì˜¤ë„ë¡ ë³´ì • */
          .donate-button {
            margin-left: auto;
            margin-right: auto;
            display: inline-block;
          }
          .donate-qr img {
            display: block;
            margin-left: auto;
            margin-right: auto;
          }
        }
        .kakao_ad_area {
          margin: 12px 0;
        }               
    </style>
    <!-- Kakao AdFit loader (í•œ ë²ˆë§Œ) -->
    <script async type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js"></script>
</head>
<body>
    <h1>ë¶€ì‚° ìº í•‘ì¥ ì‹¤ì‹œê°„ ì˜ˆì•½ ì •ë³´</h1>
    <form class="date-selector" id="dateForm" method="POST" action="{{ url_for('home') }}">
        <label for="resdate">ì˜ˆì•½ ì¡°íšŒ ë‚ ì§œ:</label>
        <button type="button" class="nav-button" onclick="moveDate(-1)">â—€</button>
        <input type="date" id="resdate" name="resdate" value="{{ selected_date }}">
        <button type="button" class="nav-button" onclick="moveDate(1)">â–¶</button>
        <button type="submit">ì¡°íšŒ</button>
        <button type="button" class="today-button" onclick="setTodayAndSubmit()">ì˜¤ëŠ˜</button>
        <button type="button" class="reserve-button" onclick="openReservationLink()">ì˜ˆì•½</button>
        <input type="hidden" id="campTabInput" name="camp_tab" value="{{ selected_camp_key }}">
    </form>
    
    <p style="font-size: 1.1em; font-weight: bold;">í˜„ì¬ ì¡°íšŒ ë‚ ì§œ: <span style="color: #007bff;">{{ selected_date }}</span></p>

    <div class="camp-tabs">
    {% for key, camp in camp_tabs.items() %}
        <button 
          class="camp-tab {% if key == selected_camp_key %}active{% endif %}" 
          onclick="switchCamp('{{ key }}')">
          {{ camp.name }}
        </button>
    {% endfor %}
    </div>

    {% for camp in all_camps %}
    <div class="camp-section">
        <!-- ì§€ë„ + ìš”ê¸ˆí‘œ (ë§¨ ìœ„) -->
        {% if camp.media is defined %}
          {% if camp.media.image_url %}
            <div class="camp-map">
              <img src="{{ camp.media.image_url }}" alt="{{ camp.name }} ì§€ë„">
            </div>
          {% endif %}

          {% if camp.media.price_table and camp.media.price_table.rows %}
            <div class="price-wrap">
              <div class="price-title">ìš”ê¸ˆ ì•ˆë‚´</div>
              <table class="price-table">
                <thead>
                  <tr>
                    <th style="width:36px;"></th>
                    <th>êµ¬ë¶„</th>
                    {% for col in camp.media.price_table.columns %}
                      <th>{{ col }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% for row in camp.media.price_table.rows %}
                  <tr>
                    <td>
                      <span class="price-chip {{ '' if row.color else 'price-chip--empty' }}"
                            style="{{ 'background: ' ~ row.color ~ ';' if row.color }}"></span>
                    </td>
                    <td>{{ row.label }}</td>
                    {% for col in camp.media.price_table.columns %}
                      <td>{{ row.cols.get(col, 'â€”') }}</td>
                    {% endfor %}
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

              {% if camp.media.price_note %}
                <div class="price-note">{{ camp.media.price_note }}</div>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}

        <h2 class="camp-title">{{ camp.name }} ìº í•‘ì¥</h2> 
        {% if camp.error %}
            <p style="color: red;">{{ camp.error }}</p>
        {% else %}

            {% if selected_camp_key == 'samnak' %}
                {# ---- ì‚¼ë½ ---- #}
                {% set total_a = 36 %}{% set total_b = 31 %}{% set total_c = 50 %}
                {% set available_a = camp.areas['area_a'].num_available %}
                {% set available_b = camp.areas['area_b'].num_available %}
                {% set available_c = camp.areas['area_c'].num_available %}
                <div class="area-map-container">
                    <div>
                        <h3>ì˜¤í†  ìº í•‘ SITE A (ì”ì—¬: {{ available_a }}ê°œ / {{ total_a }}ê°œ)</h3>
                        <div class="table-wrap">
                            <table class="area-table-a">
                                {% set rows = [
                                    ['ë¹ˆ', '07', '06', '05', '04', '03', '02', '01'],
                                    ['08', 'ë¹ˆ', '27', '26', '25', '24', '23', 'ë¹ˆ'],
                                    ['09', '28', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '22'],
                                    ['10', '29', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '21'],
                                    ['11', '30', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '20'],
                                    ['12', '31', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '19'],
                                    ['13', 'ë¹ˆ', '14', '15', '16', '17', '18', 'ë¹ˆ']
                                ] %}
                                {% for row in rows %}
                                    <tr>
                                    {% for site_num in row %}
                                        {% if site_num == 'ë¹ˆ' %}
                                            <td></td>
                                        {% else %}
                                            <td class="{% if site_num in camp.areas['area_a'].available %}status-on{% elif site_num in camp.areas['area_a'].unavailable %}status-booked{% else %}status-off{% endif %}">{{ site_num }}</td>
                                        {% endif %}
                                    {% endfor %}
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                    <div>
                        <h3>ì˜¤í†  ìº í•‘ SITE B (ì”ì—¬: {{ available_b }}ê°œ / {{ total_b }}ê°œ)</h3>
                        <div class="table-wrap">
                            <table class="area-table-b">
                                {% set rows = [
                                    ['01', '02', '03', '04', '05', '06', '07', 'ë¹ˆ'],
                                    ['ë¹ˆ', '23', '24', '25', '26', '27', 'ë¹ˆ', '08'],
                                    ['22', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '28', '09'],
                                    ['21', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '29', '10'],
                                    ['20', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '30', '11'],
                                    ['19', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', 'ë¹ˆ', '31', '12'],
                                    ['ë¹ˆ', '18', '17', '16', '15', '14', 'ë¹ˆ', '13']
                                ] %}
                                {% for row in rows %}
                                    <tr>
                                    {% for site_num in row %}
                                        {% if site_num == 'ë¹ˆ' %}
                                            <td></td>
                                        {% else %}
                                            <td class="{% if site_num in camp.areas['area_b'].available %}status-on{% elif site_num in camp.areas['area_b'].unavailable %}status-booked{% else %}status-off{% endif %}">{{ site_num }}</td>
                                        {% endif %}
                                    {% endfor %}
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>

                <div class="camp-area">
                    <h3>ì¼ë°˜ ìº í•‘ SITE C (ì”ì—¬: {{ available_c }}ê°œ / {{ total_c }}ê°œ)</h3>
                    <div class="site-list">
                    {% for i in range(1, 51) %}
                        {% set site_num = "%02d" | format(i) %}
                        {% set status_class = "text-available" if site_num in camp.areas['area_c'].available else ("text-unavailable" if site_num in camp.areas['area_c'].unavailable else "") %}
                        <div class="site-item {{ status_class }}">{{ site_num }}</div>
                    {% endfor %}
                    </div>
                </div>

            {% elif selected_camp_key == 'daejeo' %}
                {# ---- ëŒ€ì € ---- #}
                {% set area_definitions = {
                    'area_a': {'name': 'Aêµ¬ì—­', 'size': '5x8', 'total': 40}, 
                    'area_b': {'name': 'Bêµ¬ì—­', 'size': '12x12', 'total': 144}, 
                    'area_c': {'name': 'Cêµ¬ì—­', 'size': '10x12', 'total': 120}, 
                    'area_d': {'name': 'Dêµ¬ì—­', 'size': '10x10', 'total': 100}
                } %}
                {% for area_key, defs in area_definitions.items() %}
                    {% set max_num = camp.areas[area_key].max_site_num %}
                    {% set total_count = defs.total %}
                    {% set available_count = camp.areas[area_key].num_available %}
                    {% set zero_padding = 2 if max_num < 100 else 3 %}
                    <div class="area-container">
                        <h3 class="area-title">{{ defs.name }} ({{ defs.size }}) (ì”ì—¬: {{ available_count }}ê°œ / {{ total_count }}ê°œ)</h3>
                        <div class="site-list">
                        {% for i in range(1, max_num + 1) %}
                            {% set site_num = ("%0" + zero_padding|string + "d") | format(i) %}
                            {% set status_class = "text-available" if site_num in camp.areas[area_key].available else ("text-unavailable" if site_num in camp.areas[area_key].unavailable else "") %}
                            <div class="site-item {{ status_class }}">{{ site_num }}</div>
                        {% endfor %}
                        {% if max_num == 0 %}
                            <p style="color:#6c757d; font-style: italic;">í•´ë‹¹ êµ¬ì—­ì˜ ì‚¬ì´íŠ¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        {% endif %}
                        </div>
                    </div>
                {% endfor %}

            {% elif selected_camp_key == 'hwamyeong' %}
                {# ---- í™”ëª… ---- #}
                {% set area_definitions = {
                    'area_a': {'name': 'Aêµ¬ì—­', 'size': 'ë¯¸ì •'},
                    'area_b': {'name': 'Bêµ¬ì—­', 'size': 'ë¯¸ì •'},
                    'area_c': {'name': 'Cêµ¬ì—­', 'size': 'ë¯¸ì •'},
                    'area_d': {'name': 'Dêµ¬ì—­', 'size': 'Dêµ¬ì—­'},
                    'area_e': {'name': 'Eêµ¬ì—­', 'size': 'Eêµ¬ì—­'}
                } %}
                {% set area_keys_to_show = ['area_a', 'area_b', 'area_c', 'area_d', 'area_e'] %}
                {% for area_key in area_keys_to_show %}
                    {% set defs = area_definitions[area_key] %}
                    {% set area_data = camp.areas[area_key] %}
                    {% if area_key in ['area_d', 'area_e'] %}
                        {% set total_count = area_data.available|length + area_data.unavailable|length %}
                        {% set site_list_full_names = area_data.available + area_data.unavailable %}
                    {% else %}
                        {% set total_count = area_data.max_site_num %}
                    {% endif %}
                    {% set available_count = area_data.num_available %}
                    <div class="area-container">
                        <h3 class="area-title">{{ defs.name }} (ì”ì—¬: {{ available_count }}ê°œ / {{ total_count }}ê°œ)</h3>
                        <div class="site-list">
                            {% if area_key in ['area_d', 'area_e'] %}
                                {% if site_list_full_names %}
                                    {% for site_name in site_list_full_names | sort %}
                                        {% set site_number_only = site_name | replace('D','') | replace('E','') %}
                                        {% set site_num_to_display = "%02d" | format(site_number_only | int) %}
                                        {% set status_class = "text-available" if site_name in area_data.available else ("text-unavailable" if site_name in area_data.unavailable else "") %}
                                        <div class="site-item {{ status_class }}">{{ site_num_to_display }}</div>
                                    {% endfor %}
                                {% else %}
                                    <p style="color:#6c757d; font-style: italic;">í•´ë‹¹ êµ¬ì—­ì˜ ì‚¬ì´íŠ¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                                {% endif %}
                            {% else %}
                                {% set max_num = area_data.max_site_num %}
                                {% if max_num > 0 %}
                                    {% for i in range(1, max_num + 1) %}
                                        {% set site_num_for_comparison = i|string %}
                                        {% set site_num_to_display = "%02d" | format(i) %}
                                        {% set status_class = "text-available" if site_num_for_comparison in area_data.available else ("text-unavailable" if site_num_for_comparison in area_data.unavailable else "") %}
                                        <div class="site-item {{ status_class }}">{{ site_num_to_display }}</div>
                                    {% endfor %}
                                {% else %}
                                    <p style="color:#6c757d; font-style: italic;">í•´ë‹¹ êµ¬ì—­ì˜ ì‚¬ì´íŠ¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}

            {% elif selected_camp_key == 'yeongdo' %}
                {# ---- ì˜ë„ ---- #}
                {% set labels = {'caravan':'ì¹´ë¼ë°˜', 'auto':'ì˜¤í† ', 'general':'ì¼ë°˜'} %}
                {% for key in ['caravan','auto','general'] %}
                    {% set area = camp.areas[key] %}
                    {% set total_count = area.total if area.total else (area.available|length + area.unavailable|length) %}
                    {% set all_sites = (area.available + area.unavailable) | unique | sort %}
                    <div class="area-container">
                        <h3 class="area-title">{{ labels[key] }} (ì”ì—¬: {{ area.num_available }}ê°œ / {{ total_count }}ê°œ)</h3>
                        <div class="site-list">
                            {% if all_sites %}
                                {% for sid in all_sites %}
                                  <div class="site-item {{ 'text-available' if sid in area.available else ('text-unavailable' if sid in area.unavailable else '') }}">
                                    {{ "%02d"|format(sid|int) if sid|string|length <= 2 else sid }}
                                  </div>
                                {% endfor %}
                            {% else %}
                                <p style="color:#6c757d; font-style: italic;">í•´ë‹¹ êµ¬ì—­ì˜ ì‚¬ì´íŠ¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
                
            {% elif selected_camp_key == 'busan_port' %}
              {# ---- ë¶€ì‚°í•­: ê³ ì • ì´ ê°œìˆ˜ í‘œê¸° ---- #}
              {% set labels = {'auto':'ì˜¤í†  ì‚¬ì´íŠ¸', 'deck':'ë°í¬ ì‚¬ì´íŠ¸'} %}
              {% set totals = {'auto': 16, 'deck': 24} %}

              {% for key in ['auto','deck'] %}
                <div class="area-container">
                  <h3 class="area-title">
                    {{ labels[key] }} (ì´ {{ totals[key] }}ê°œ)
                  </h3>

                  {# í•„ìš”í•˜ë©´ ì•„ë˜ ì•ˆë‚´ ë¬¸êµ¬ ìœ ì§€/ìˆ˜ì • ê°€ëŠ¥ #}
                  <p style="color:#6c757d; font-size:14px; margin:6px 2px 0;">
                    ì‹¤ì‹œê°„ ì”ì—¬ ì¢Œì„ì€ ì˜ˆì•½ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
                  </p>
                </div>
              {% endfor %}

            {% elif selected_camp_key == 'gudeok' %}
                {# ---- êµ¬ë• (ì•¼ì˜ì¥ë³„ ê·¸ë£¹í™”) ---- #}
                {% set area = camp.areas['deck'] %}

                {# ê³ ì • ì¢Œì„ êµ¬ì„± #}
                {% set group_defs = [
                    {'label':'1 ì•¼ì˜ì¥', 'sites':['1-1','1-2']},
                    {'label':'2 ì•¼ì˜ì¥', 'sites':['2-1','2-2','2-3','2-4']},
                    {'label':'3 ì•¼ì˜ì¥', 'sites':['3-1','3-2','3-3']},
                    {'label':'4 ì•¼ì˜ì¥', 'sites':['4-1','4-2','4-3']},
                    {'label':'5 ì•¼ì˜ì¥', 'sites':['5-1','5-2','5-3','5-4']},
                    {'label':'6 ì•¼ì˜ì¥', 'sites':['6-1','6-2']},
                ] %}

                {% for grp in group_defs %}
                    {% set ns = namespace(av=0) %}
                    {% for sid in grp.sites %}
                        {% if sid in area.available %}{% set ns.av = ns.av + 1 %}{% endif %}
                    {% endfor %}

                    <div class="area-container">
                        <h3 class="area-title">
                            {{ grp.label }} (ì”ì—¬: {{ ns.av }}ê°œ / {{ grp.sites|length }}ê°œ)
                        </h3>
                        <div class="site-list">
                            {% for sid in grp.sites %}
                                {# available / unavailable / (ë¯¸í™•ì¸ ì‹œ ê¸°ë³¸ ìŠ¤íƒ€ì¼) #}
                                {% set status_class = 'text-available' if sid in area.available
                                    else ('text-unavailable' if sid in area.unavailable else '') %}
                                <div class="site-item {{ status_class }}">{{ sid }}</div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}

            {% else %}
                <p>í‘œì‹œí•  ìº í•‘ì¥ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}

        {% endif %}
    </div>
    {% endfor %}

    <script>
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0'); 
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        function setTodayAndSubmit() {
            document.getElementById('resdate').value = formatDate(new Date());
            document.getElementById('dateForm').submit();
        }
        function moveDate(dayChange) {
            const input = document.getElementById('resdate');
            const [yy, mm, dd] = input.value.split('-').map(v=>parseInt(v,10));
            const dt = new Date(yy, mm-1, dd);
            dt.setDate(dt.getDate() + dayChange);
            input.value = formatDate(dt);
            document.getElementById('dateForm').submit();
        }
        function openReservationLink() {
            const key = document.getElementById('campTabInput').value;
            const d = document.getElementById('resdate').value;
            let url_base;
            if (key === 'daejeo') {
                url_base = "https://www.daejeocamping.com/reservation/real_time?resdate=";
            } else if (key === 'hwamyeong') {
                url_base = "https://hwamyungcamping.com/reservation/real_time?resdate=";
            } else if (key === 'yeongdo') {
                window.open("https://www.yeongdo.go.kr/marinocamping/00003/00015/00028.web", "_blank"); return;
            } else if (key === 'busan_port') {
              window.open("https://www.busanpa.com/redevelopment/Board.do?mCode=MN0082", "_blank"); 
              return;
            } else if (key === 'gudeok') {
                window.open("https://gudeok.go.kr/rent_camp01.php", "_blank"); return;

            } else { // samnak ë“±
                url_base = "https://www.nakdongcamping.com/reservation/real_time?resdate=";
            }
            const reservationUrl = url_base + d + "&schGugun=1&price=0&bagprice=2000&allprice=0&percnt=0&g-recaptcha-response=";
            window.open(reservationUrl, '_blank');
        }
        function switchCamp(campKey) {
            document.getElementById('campTabInput').value = campKey;
            document.getElementById('dateForm').submit();
        }
    </script>
    <!-- í›„ì›í•˜ê¸° ì„¹ì…˜ -->
    <section class="donate-wrap">
      <div class="donate-card">
        <h2 class="donate-title">í›„ì›í•˜ê¸°</h2>
        <p class="donate-desc">
          ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ ì»¤í”¼ í•œ ì” í›„ì›í•´ ì£¼ì„¸ìš” â˜•ï¸<br>
          ì¹´ì¹´ì˜¤ í˜ì´ë¡œ ì•ˆì „í•˜ê²Œ ì†¡ê¸ˆí•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.
        </p>
        <div class="donate-actions">
          <!-- ğŸ”— ì¹´ì¹´ì˜¤í˜ì´ ì†¡ê¸ˆ ë§í¬: ì‹¤ì œ ë³µì‚¬í•œ ë§í¬ë¡œ êµì²´ -->
          <a class="donate-button" href="https://qr.kakaopay.com/Ej8wCmrfN" target="_blank" rel="noopener noreferrer">
            ì¹´ì¹´ì˜¤ í˜ì´ë¡œ ì†¡ê¸ˆí•˜ê¸°
          </a>
        </div>

        <!-- QR (ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿ì—ì„œ íŠ¹íˆ ìœ ìš©) -->
        <div class="donate-qr">
          <img src="{{ url_for('static', filename='qrcode_donation.png') }}" alt="ì¹´ì¹´ì˜¤í˜ì´ ì†¡ê¸ˆ QR" />
          <div class="donate-qr-caption">íœ´ëŒ€í° ì¹´ë©”ë¼ë¡œ QRì„ ìŠ¤ìº”í•´ ì£¼ì„¸ìš”</div>
        </div>
      </div>
    </section>
    <!-- ì˜ˆ: ë°˜ì‘í˜• ë°°ë„ˆ (ê°€ë¡œ 320 x ì„¸ë¡œ 100) -->
    <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit = "DAN-WPxG6Yasp5xS2m0G"
    data-ad-width = "300"
    data-ad-height = "250"></ins>
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
</body>
</html>

