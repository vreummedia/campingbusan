<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부산 캠핑장 정보</title>
    <style>
        .price-chip{
          display:inline-block;
          width:16px; height:16px;
          border-radius:4px;
          border:1px solid rgba(0,0,0,.1);
          vertical-align:middle;
        }
        .price-chip--empty{
          background: #e9ecef;
        }
        /* 공통: 모바일/태블릿은 가로폭 꽉 차게 */
        .camp-map { margin: 6px 0 10px; }
        .camp-map img {
          display: block;
          width: 100%;
          height: auto;            /* 세로 비율 유지 */
          margin: 0 auto;          /* 중앙 정렬 */
          border-radius: 12px;
          border: 1px solid #ddd;
          background: #f8f8f8;
          /* object-fit: contain;   필요 없다면 생략, cover 쓰지 마세요 (자름) */
        }
        /* 데스크톱(넓은 화면)에서는 절반 크기 + 가운데 정렬 */
        @media (min-width: 992px) {
          .camp-map img {
            width: 50%;           /* 컨텐츠 폭의 절반 */
            max-width: 900px;     /* 너무 큰 모니터에서 과도하게 커지지 않도록 상한선 */
          }
        }
        /* 요금표 */
        .price-wrap {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0 16px;
        }
        .price-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }
        .price-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        .price-table th, .price-table td {
            border: 1px solid #eee;
            padding: 8px 10px;
            text-align: center;
        }
        .price-table th {
            background: #f1f3f5;
            font-weight: 700;
            color: #333;
        }
        .price-note {
            margin-top: 8px;
            color: #495057;
            font-size: 14px;
        }

        /* 기본 스타일 */
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        .camp-section { border: 1px solid #ddd; padding: 20px; margin-bottom: 25px; border-radius: 12px; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .camp-title { font-size: 28px; color: #333; margin-bottom: 15px; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        
        /* 날짜 선택기 */
        .date-selector { 
            margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; 
            background-color: #e9ecef; display: flex; align-items: center; flex-wrap: wrap;
        }
        .date-selector label { font-weight: bold; margin-right: 10px; color: #333; }
        .date-selector input[type="date"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin: 0 5px; }
        .date-selector button { 
            padding: 8px 15px; background-color: #007bff; color: white; border: none; 
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 5px; 
        }
        .date-selector .today-button { background-color: #28a745; }
        .date-selector .reserve-button { background-color: #ffc107; color: #212529; font-weight: bold; margin-left: 10px; }
        .date-selector .nav-button { padding: 8px 10px; font-size: 16px; background-color: #6c757d; color: white; margin: 0; line-height: 1; }
        .date-selector .nav-button:hover { background-color: #5a6268; }
        
        /* 탭 */
        .camp-tabs { display: flex; justify-content: flex-start; margin: 20px 0; border-bottom: 2px solid #ccc; flex-wrap: wrap; }
        .camp-tab { padding: 10px 15px; cursor: pointer; font-size: 18px; font-weight: bold; color: #6c757d; border: none; background-color: transparent; border-bottom: 2px solid transparent; transition: all 0.2s; margin-right: 5px; }
        .camp-tab:hover { color: #007bff; }
        .camp-tab.active { color: #007bff; border-bottom: 2px solid #007bff; background-color: #e9ecef; border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .camp-tab.disabled { color:#aaa; cursor:not-allowed; opacity:.6; }
        
        /* 삼락 A/B 테이블 */
        .area-map-container { display: flex; justify-content: space-around; flex-wrap: nowrap; margin-bottom: 20px; width: 100%; }
        .area-map-container > div { width: 50%; padding: 0 10px; box-sizing: border-box; text-align: center; }
        .area-table-a, .area-table-b { border-collapse: collapse; margin: 10px auto; width: 100%; max-width: 550px; }
        
        /* === 삼락 A/B 표 반응형 === */
        .table-wrap {
          width: 100%;
          overflow-x: auto;            /* 아주 작은 화면에서 마지막 안전장치 */
          -webkit-overflow-scrolling: touch;
        }

        .area-table-a,
        .area-table-b {
          width: 100%;                 /* 컨테이너 폭에 딱 맞게 */
          max-width: 100%;             /* 더 커지지 않게 */
          table-layout: fixed;         /* 칸을 균등 분배해서 줄임 */
          font-size: clamp(11px, 2.6vw, 16px);  /* 화면에 따라 글자 크기도 유연하게 */
        }

        .area-table-a td,
        .area-table-b td {
          min-width: 0;                /* 40px 고정 폭 제거 */
          height: auto;                /* 고정 높이 제거(내용에 맞춰) */
          padding: 8px 6px;            /* 기본 패딩 조금 줄이기 */
          box-sizing: border-box;
        }

        /* 좁은 폰에서 한 번 더 압축 */
        @media (max-width: 420px) {
          .area-table-a td,
          .area-table-b td {
            padding: 6px 4px;
          }
          .area-table-a,
          .area-table-b {
            font-size: clamp(10px, 3.2vw, 14px);
          }
        }
        
        .status-on { background-color: #28a745; color: white; font-weight: bold; }
        .status-off { background-color: #e9ecef; color: black; }
        .status-booked { background-color: #dc3545; color: white; font-weight: bold; }

        /* 나열형 박스 (대저/영도/구덕/부산항 등 공용) */
        .area-container { margin-top: 0 !important; margin-bottom: 0 !important; padding-top: 0 !important; padding-bottom: 0 !important; }
        .area-container + .area-container { margin-top: 5px; }
        .area-container h3 { margin-bottom: 5px; padding-bottom: 0; }
        .site-list { display: flex; flex-wrap: wrap; justify-content: flex-start; margin-top: 15px; max-width: 100%; font-size: 0; }
        .site-item { background-color: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 5px; margin: 4px; width: 45px; height: 45px; line-height: 35px; text-align: center; color: black; font-size: 16px; font-weight: bold; }
        .site-item.text-available { background-color: #e6ffe6; color: #008000; border-color: #008000; }
        .site-item.text-unavailable { background-color: #ffe6e6; color: #ff0000; border-color: #ff0000; }

        @media (max-width: 768px) {
          .price-table th, .price-table td { padding: 8px 6px; font-size: 14px; }
          .camp-map img { max-height: 260px; }

          .area-map-container {
            flex-direction: column;
            align-items: stretch;
          }
          .area-map-container > div {
            width: 100%;
            max-width: none;
            padding: 0;
            margin-bottom: 20px;
          }
          .area-table-a, .area-table-b {
            width: 100%;
            max-width: 100%;
          }
        }
        /* 후원 섹션 */
        .donate-wrap { margin: 18px 0 28px; }
        .donate-card {
          background: #fff; border: 1px solid #e9ecef; border-radius: 14px;
          padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,.06);
        }
        .donate-title { margin: 0 0 6px; font-size: 22px; color: #222; }
        .donate-desc { margin: 0 0 12px; color: #495057; line-height: 1.6; }
        .donate-actions { margin: 8px 0 14px; }
        .donate-button {
          display: inline-block; padding: 10px 14px; border-radius: 8px;
          background: #f7e317; color: #111; font-weight: 800; text-decoration: none;
          border: 1px solid rgba(0,0,0,.08);
        }
        .donate-button:hover { filter: brightness(.98); }

        .donate-qr { margin-top: 12px; text-align: center; }
        .donate-qr img {
          width: 180px; height: 180px; object-fit: contain; border-radius: 10px;
          border: 1px solid #eee; background: #fff;
        }
        .donate-qr-caption { font-size: 13px; color:#666; margin-top: 6px; }

        .donate-note {
          margin-top: 12px; font-size: 13px; color: #6c757d; line-height: 1.6;
        }

        /* 모바일 최적화 */
        @media (max-width: 480px) {
          .donate-qr img { width: 160px; height: 160px; }
        }
        /* PC 기본: 왼쪽 정렬 */
        .donate-actions,
        .donate-qr {
          text-align: left;
        }

        /* 모바일(태블릿 포함)에서는 가운데 정렬 */
        @media (max-width: 768px) {
          .donate-actions,
          .donate-qr {
            text-align: center;
          }
          /* 버튼/이미지가 중앙에 예쁘게 오도록 보정 */
          .donate-button {
            margin-left: auto;
            margin-right: auto;
            display: inline-block;
          }
          .donate-qr img {
            display: block;
            margin-left: auto;
            margin-right: auto;
          }
        }
                             
        .kakao_ad_area {
          margin: 12px 0;
        }

        /* --- footer --- */
        .footer {
          margin-top: 28px;
          padding: 16px 12px;
          color: #6c757d;
          font-size: 14px;
          text-align: center;
          border-top: 1px solid #e9ecef;
          background: #fafafa;
        }
        /* 전체 요약 표 - 열 너비 균일 + 비고 좁게 */
        .all-table{
          width:100%;
          border-collapse:collapse;
          table-layout:fixed;            /* colgroup 비율 강제 */
          font-size:14px;
        }
        .all-table th, .all-table td{
          border:1px solid #eee;
          padding:8px 10px;
          text-align:center;
          white-space:normal;      /* 줄바꿈 허용 */
          overflow:visible;        /* 잘라내지 않음 */
          text-overflow:clip;      /* 말줄임 해제 */
          word-break:keep-all;     /* 한글 단어 단위 유지(필요시) */
        }
        @media (max-width:480px){
          .all-table{ font-size:12px; }   /* 모바일에서 글자 조금 줄임 */
          .all-table th, .all-table td{ padding:6px 6px; }
        }

        .all-table th{ background:#f1f3f5; }

        /* 캠핑장 그룹 시작줄 굵은 선 */
        .all-table tr.tr-camp-start td,
        .all-table tr.tr-camp-start th{
          border-top:2px solid #ced4da;
        }

        @media (max-width:768px){
          .all-table th, .all-table td{ padding:6px 6px; font-size:13px; }
        }

    </style>
</head>
<body>
    <h1>부산 캠핑장 실시간 예약 정보</h1>
    <form class="date-selector" id="dateForm" method="POST" action="{{ url_for('home') }}">
        <label for="resdate">예약 조회 날짜:</label>
        <button type="button" class="nav-button" onclick="moveDate(-1)">◀</button>
        <input type="date" id="resdate" name="resdate" value="{{ selected_date }}">
        <button type="button" class="nav-button" onclick="moveDate(1)">▶</button>
        <button type="submit">조회</button>
        <button type="button" class="today-button" onclick="setTodayAndSubmit()">오늘</button>
        <button type="button" class="reserve-button" onclick="openReservationLink()">예약</button>
        <input type="hidden" id="campTabInput" name="camp_tab" value="{{ selected_camp_key }}">
    </form>
    
    <p style="font-size: 1.1em; font-weight: bold;">현재 조회 날짜: <span style="color: #007bff;">{{ selected_date }}</span></p>

    <div class="camp-tabs">
    {% for key, camp in camp_tabs.items() %}
        <button 
          class="camp-tab {% if key == selected_camp_key %}active{% endif %}" 
          onclick="switchCamp('{{ key }}')">
          {{ camp.name }}
        </button>
    {% endfor %}
    </div>
    {% if selected_camp_key == 'all' %}

    {% macro price_of(camp, label_contains, colname) -%}
      {% set pt = camp.media.price_table if camp.media and camp.media.price_table else None %}
      {% if pt and pt.rows %}
        {% set ns = namespace(val='—', found=false) %}
        {% for r in pt.rows %}
          {% if not ns.found and (label_contains in (r.label or '')) %}
            {% set ns.val = r.cols.get(colname, '—') %}
            {% set ns.found = true %}
          {% endif %}
        {% endfor %}
        {{ ns.val }}
      {% else %}—{% endif %}
    {%- endmacro %}

    <table class="all-table">
      <colgroup>
        <col style="width:14%;">
        <col style="width:14%;">
        <col style="width:18%;">
        <col style="width:18%;">
        <col style="width:18%;">
        <col style="width:18%;">
      </colgroup>
      <thead>
        <tr>
          <th>캠핑장</th>
          <th>구역/타입</th>
          <th>평일</th>
          <th>주말</th>
          <th>잔여/총</th>
          <th>비고</th>
        </tr>
      </thead>
      <tbody>

      {% for camp in all_camps %}
        {% if camp.name == '삼락' %}
          {% set rows = [
            {'label':'오토 A','key':'area_a','weekday': price_of(camp,'오토 캠핑','평일'),'weekend': price_of(camp,'오토 캠핑','주말'),'total':36},
            {'label':'오토 B','key':'area_b','weekday': price_of(camp,'오토 캠핑','평일'),'weekend': price_of(camp,'오토 캠핑','주말'),'total':31},
            {'label':'일반 C','key':'area_c','weekday': price_of(camp,'일반 캠핑','평일'),'weekend': price_of(camp,'일반 캠핑','주말'),'total':50},
          ] %}
          {% for r in rows %}
            <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
              {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
              <td>{{ r.label }}</td>
              <td>{{ r.weekday }}</td>
              <td>{{ r.weekend }}</td>
              <td>{{ (camp.areas.get(r.key, {}).num_available or 0) }} / {{ r.total }}</td>
              <td></td>
            </tr>
          {% endfor %}

        {% elif camp.name == '대저' %}
          {% set rows = [
            {'label':'A구역 (5x8)','key':'area_a','weekday': price_of(camp,'A구역','평일'),'weekend': price_of(camp,'A구역','주말'),'total':36},
            {'label':'B구역 (12x12)','key':'area_b','weekday': price_of(camp,'B구역','평일'),'weekend': price_of(camp,'B구역','주말'),'total':7},
            {'label':'C구역 (10x12)','key':'area_c','weekday': price_of(camp,'C구역','평일'),'weekend': price_of(camp,'C구역','주말'),'total':16},
            {'label':'D구역 (10x10)','key':'area_d','weekday': price_of(camp,'D구역','평일'),'weekend': price_of(camp,'D구역','주말'),'total':52},
          ] %}
          {% for r in rows %}
            <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
              {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
              <td>{{ r.label }}</td>
              <td>{{ r.weekday }}</td>
              <td>{{ r.weekend }}</td>
              <td>{{ (camp.areas.get(r.key, {}).num_available or 0) }} / {{ r.total }}</td>
              <td></td>
            </tr>
          {% endfor %}

        {% elif camp.name == '화명' %}
          {% set wk = price_of(camp,'전 구역','평일') %}
          {% set we = price_of(camp,'전 구역','주말') %}
          {% set defs = {'area_a':'A구역','area_b':'B구역','area_c':'C구역','area_d':'D구역','area_e':'E구역'} %}
          {% set keys = ['area_a','area_b','area_c','area_d','area_e'] %}
          {% set rows = [] %}
          {% for k in keys %}
            {% set a = camp.areas.get(k, {}) %}
            {% set total = (a.max_site_num if k in ['area_a','area_b','area_c'] else (a.available|length + a.unavailable|length)) %}
            {% set _ = rows.append({'label': defs[k], 'key': k, 'weekday': wk, 'weekend': we, 'total': total}) %}
          {% endfor %}
          {% for r in rows %}
            <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
              {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
              <td>{{ r.label }}</td>
              <td>{{ r.weekday }}</td>
              <td>{{ r.weekend }}</td>
              <td>{{ (camp.areas.get(r.key, {}).num_available or 0) }} / {{ r.total }}</td>
              <td></td>
            </tr>
          {% endfor %}

        {% elif camp.name == '영도' %}
          {% set caravan = camp.areas.get('caravan', {}) %}
          {% set auto    = camp.areas.get('auto', {}) %}
          {% set general = camp.areas.get('general', {}) %}
          {% set rows = [
            {'label':'카라반 (6인용)','weekday': price_of(camp,'카라반 (6인용)','평일'),'weekend': price_of(camp,'카라반 (6인용)','주말'),'remain': caravan.num_available,'total':15,'note': price_of(camp,'카라반 (6인용)','성수기') ~ ' (성수기: 7~8월)'},
            {'label':'카라반 (4인용)','weekday': price_of(camp,'카라반 (4인용)','평일'),'weekend': price_of(camp,'카라반 (4인용)','주말'),'remain': caravan.num_available,'total':15,'note': price_of(camp,'카라반 (4인용)','성수기') ~ ' (성수기: 7~8월)'},
            {'label':'오토','weekday': price_of(camp,'오토','평일'),'weekend': price_of(camp,'오토','주말'),'remain': auto.num_available,'total':40,'note': price_of(camp,'오토','성수기') ~ ' (성수기: 7~8월)'},
            {'label':'일반','weekday': price_of(camp,'일반','평일'),'weekend': price_of(camp,'일반','주말'),'remain': general.num_available,'total':12,'note': price_of(camp,'일반','성수기') ~ ' (성수기: 7~8월)'}
          ] %}
          {% for r in rows %}
            <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
              {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
              <td>{{ r.label }}</td>
              <td>{{ r.weekday }}</td>
              <td>{{ r.weekend }}</td>
              <td>{{ r.remain }} / {{ r.total }}</td>
              <td>{{ r.note }}</td>
            </tr>
          {% endfor %}

        {% elif camp.name == '부산항' %}
          {% set rows = [
            {'label':'오토','weekday': price_of(camp,'오토','요금'),'weekend':'—','remain':0,'total':16,'note':'인터파크에서 확인'},
            {'label':'데크','weekday': price_of(camp,'데크','요금'),'weekend':'—','remain':0,'total':24,'note':'인터파크에서 확인'}
          ] %}
          {% for r in rows %}
            <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
              {% if loop.first %}<td rowspan="{{ rows|length }}">{{ camp.name }}</td>{% endif %}
              <td>{{ r.label }}</td>
              <td>{{ r.weekday }}</td>
              <td>{{ r.weekend }}</td>
              <td>{{ r.remain }} / {{ r.total }}</td>
              <td>{{ r.note }}</td>
            </tr>
          {% endfor %}
        {% elif camp.name == '구덕' %}
          {% set area = camp.areas.get('deck', {}) %}

          {# 아이디 정규화: 모두 문자열로, 앞뒤 공백 제거 #}
          {% set avail = (area.available or []) | map('string') | map('trim') | list %}
          {% set unavail = (area.unavailable or []) | map('string') | map('trim') | list %}

          {% set groups = [
            ('1야영장',['1-1','1-2']),
            ('2야영장',['2-1','2-2','2-3','2-4']),
            ('3야영장',['3-1','3-2','3-3']),
            ('4야영장',['4-1','4-2','4-3']),
            ('5야영장',['5-1','5-2','5-3','5-4']),
            ('6야영장',['6-1','6-2'])
          ] %}

          {# 전체 좌석 수 #}
          {% set total_all = 0 %}
          {% for _lbl, _ids in groups %}
            {% set total_all = total_all + (_ids|length) %}
          {% endfor %}

          {# 리스트가 비어있고 합계만 온 경우 대비 #}
          {% set sum_avail = area.num_available or 0 %}
          {% set has_lists = (avail|length + unavail|length) > 0 %}
          {% set treat_all_free = (not has_lists) and (sum_avail == total_all) %}

          {% for label, ids in groups %}
            {# 그룹 가용 수 계산 #}
            {% if has_lists %}
              {% set ns = namespace(av=0) %}
              {% for sid in ids %}
                {% set sid_norm = sid|string|trim %}
                {% if sid_norm in avail %}{% set ns.av = ns.av + 1 %}{% endif %}
              {% endfor %}
              {% set av_cnt = ns.av %}
            {% elif treat_all_free %}
              {% set av_cnt = ids|length %}
            {% else %}
              {% set av_cnt = None %}
            {% endif %}

            <tr class="{{ 'tr-camp-start' if loop.first else '' }}">
              {% if loop.first %}<td rowspan="{{ groups|length }}">{{ camp.name }}</td>{% endif %}
              <td>{{ label }}</td>
              <td>10,000원 (4인 이하)</td>
              <td>20,000원 (5~9인 이하)</td>
              <td>{{ (av_cnt if av_cnt is not none else '—') }} / {{ ids|length }}</td>
              <td>
                {% if loop.first and (not has_lists) and (not treat_all_free) %}
                  합계: {{ sum_avail }} / {{ total_all }}
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        {% endif %}

      {% endfor %}
      </tbody>
    </table>
    {% else %}

    {% for camp in all_camps %}
      <div class="camp-section">
        {# --- 지도 + 요금표 --- #}
        {% if camp.media is defined %}
          {% if camp.media.image_url %}
            <div class="camp-map">
              <img src="{{ camp.media.image_url }}" alt="{{ camp.name }} 지도">
            </div>
          {% endif %}

          {% if camp.media.price_table and camp.media.price_table.rows %}
            <div class="price-wrap">
              <div class="price-title">요금 안내</div>
              <table class="price-table">
                <thead>
                  <tr>
                    <th style="width:36px;"></th>
                    <th>구분</th>
                    {% for col in camp.media.price_table.columns %}
                      <th>{{ col }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% for row in camp.media.price_table.rows %}
                  <tr>
                    <td>
                      <span class="price-chip {{ '' if row.color else 'price-chip--empty' }}"
                            style="{{ 'background: ' ~ row.color ~ ';' if row.color }}"></span>
                    </td>
                    <td>{{ row.label }}</td>
                    {% for col in camp.media.price_table.columns %}
                      <td>{{ row.cols.get(col, '—') }}</td>
                    {% endfor %}
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

              {% if camp.media.price_note %}
                <div class="price-note">{{ camp.media.price_note }}</div>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}

        <h2 class="camp-title">{{ camp.name }} 캠핑장</h2>

        {# 에러면 메시지만 보여주고, 아니면 아래 탭별 디스플레이 #}
        {% if camp.error %}
          <p style="color: red;">{{ camp.error }}</p>
        {% else %}

          {% if selected_camp_key == 'samnak' %}
            {# ---- 삼락 ---- #}
            {% set total_a = 36 %}{% set total_b = 31 %}{% set total_c = 50 %}
            {% set available_a = camp.areas['area_a'].num_available %}
            {% set available_b = camp.areas['area_b'].num_available %}
            {% set available_c = camp.areas['area_c'].num_available %}
            <div class="area-map-container">
              <div>
                <h3>오토 캠핑 SITE A (잔여: {{ available_a }}개 / {{ total_a }}개)</h3>
                <div class="table-wrap">
                  <table class="area-table-a">
                    {% set rows = [
                      ['빈','07','06','05','04','03','02','01'],
                      ['08','빈','27','26','25','24','23','빈'],
                      ['09','28','빈','빈','빈','빈','빈','22'],
                      ['10','29','빈','빈','빈','빈','빈','21'],
                      ['11','30','빈','빈','빈','빈','빈','20'],
                      ['12','31','빈','빈','빈','빈','빈','19'],
                      ['13','빈','14','15','16','17','18','빈']
                    ] %}
                    {% for row in rows %}
                      <tr>
                        {% for site_num in row %}
                          {% if site_num == '빈' %}
                            <td></td>
                          {% else %}
                            <td class="{% if site_num in camp.areas['area_a'].available %}status-on{% elif site_num in camp.areas['area_a'].unavailable %}status-booked{% else %}status-off{% endif %}">{{ site_num }}</td>
                          {% endif %}
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </table>
                </div>
              </div>
              <div>
                <h3>오토 캠핑 SITE B (잔여: {{ available_b }}개 / {{ total_b }}개)</h3>
                <div class="table-wrap">
                  <table class="area-table-b">
                    {% set rows = [
                      ['01','02','03','04','05','06','07','빈'],
                      ['빈','23','24','25','26','27','빈','08'],
                      ['22','빈','빈','빈','빈','빈','28','09'],
                      ['21','빈','빈','빈','빈','빈','29','10'],
                      ['20','빈','빈','빈','빈','빈','30','11'],
                      ['19','빈','빈','빈','빈','빈','31','12'],
                      ['빈','18','17','16','15','14','빈','13']
                    ] %}
                    {% for row in rows %}
                      <tr>
                        {% for site_num in row %}
                          {% if site_num == '빈' %}
                            <td></td>
                          {% else %}
                            <td class="{% if site_num in camp.areas['area_b'].available %}status-on{% elif site_num in camp.areas['area_b'].unavailable %}status-booked{% else %}status-off{% endif %}">{{ site_num }}</td>
                          {% endif %}
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </table>
                </div>
              </div>
            </div>

            <div class="camp-area">
              <h3>일반 캠핑 SITE C (잔여: {{ available_c }}개 / {{ total_c }}개)</h3>
              <div class="site-list">
                {% for i in range(1, 51) %}
                  {% set site_num = "%02d"|format(i) %}
                  {% set status_class = "text-available" if site_num in camp.areas['area_c'].available else ("text-unavailable" if site_num in camp.areas['area_c'].unavailable else "") %}
                  <div class="site-item {{ status_class }}">{{ site_num }}</div>
                {% endfor %}
              </div>
            </div>

          {% elif selected_camp_key == 'daejeo' %}
            {# ---- 대저 ---- #}
            {% set area_definitions = {
              'area_a': {'name':'A구역','size':'5x8','total':36},
              'area_b': {'name':'B구역','size':'12x12','total':7},
              'area_c': {'name':'C구역','size':'10x12','total':16},
              'area_d': {'name':'D구역','size':'10x10','total':52}
            } %}
            {% for area_key, defs in area_definitions.items() %}
              {% set max_num = camp.areas[area_key].max_site_num %}
              {% set total_count = defs.total %}
              {% set available_count = camp.areas[area_key].num_available %}
              {% set zero_padding = 2 if max_num < 100 else 3 %}
              <div class="area-container">
                <h3 class="area-title">{{ defs.name }} ({{ defs.size }}) (잔여: {{ available_count }}개 / {{ total_count }}개)</h3>
                <div class="site-list">
                  {% for i in range(1, max_num + 1) %}
                    {% set site_num = ("%0" + zero_padding|string + "d")|format(i) %}
                    {% set status_class = "text-available" if site_num in camp.areas[area_key].available else ("text-unavailable" if site_num in camp.areas[area_key].unavailable else "") %}
                    <div class="site-item {{ status_class }}">{{ site_num }}</div>
                  {% endfor %}
                  {% if max_num == 0 %}
                    <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                  {% endif %}
                </div>
              </div>
            {% endfor %}

          {% elif selected_camp_key == 'hwamyeong' %}
            {# ---- 화명 ---- #}
            {% set area_definitions = {
              'area_a': {'name':'A구역','size':'미정'},
              'area_b': {'name':'B구역','size':'미정'},
              'area_c': {'name':'C구역','size':'미정'},
              'area_d': {'name':'D구역','size':'D구역'},
              'area_e': {'name':'E구역','size':'E구역'}
            } %}
            {% set area_keys_to_show = ['area_a','area_b','area_c','area_d','area_e'] %}
            {% for area_key in area_keys_to_show %}
              {% set defs = area_definitions[area_key] %}
              {% set area_data = camp.areas[area_key] %}
              {% if area_key in ['area_d','area_e'] %}
                {% set total_count = area_data.available|length + area_data.unavailable|length %}
                {% set site_list_full_names = area_data.available + area_data.unavailable %}
              {% else %}
                {% set total_count = area_data.max_site_num %}
              {% endif %}
              {% set available_count = area_data.num_available %}
              <div class="area-container">
                <h3 class="area-title">{{ defs.name }} (잔여: {{ available_count }}개 / {{ total_count }}개)</h3>
                <div class="site-list">
                  {% if area_key in ['area_d','area_e'] %}
                    {% if site_list_full_names %}
                      {% for site_name in site_list_full_names|sort %}
                        {% set site_number_only = site_name|replace('D','')|replace('E','') %}
                        {% set site_num_to_display = "%02d"|format(site_number_only|int) %}
                        {% set status_class = "text-available" if site_name in area_data.available else ("text-unavailable" if site_name in area_data.unavailable else "") %}
                        <div class="site-item {{ status_class }}">{{ site_num_to_display }}</div>
                      {% endfor %}
                    {% else %}
                      <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                    {% endif %}
                  {% else %}
                    {% set max_num = area_data.max_site_num %}
                    {% if max_num > 0 %}
                      {% for i in range(1, max_num + 1) %}
                        {% set site_num_for_comparison = i|string %}
                        {% set site_num_to_display = "%02d"|format(i) %}
                        {% set status_class = "text-available" if site_num_for_comparison in area_data.available else ("text-unavailable" if site_num_for_comparison in area_data.unavailable else "") %}
                        <div class="site-item {{ status_class }}">{{ site_num_to_display }}</div>
                      {% endfor %}
                    {% else %}
                      <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                    {% endif %}
                  {% endif %}
                </div>
              </div>
            {% endfor %}

          {% elif selected_camp_key == 'yeongdo' %}
            {# ---- 영도 ---- #}
            {% set labels = {'caravan':'카라반','auto':'오토','general':'일반'} %}
            {% for key in ['caravan','auto','general'] %}
              {% set area = camp.areas[key] %}
              {% set total_count = area.total if area.total else (area.available|length + area.unavailable|length) %}
              {% set all_sites = (area.available + area.unavailable)|unique|sort %}
              <div class="area-container">
                <h3 class="area-title">{{ labels[key] }} (잔여: {{ area.num_available }}개 / {{ total_count }}개)</h3>
                <div class="site-list">
                  {% if all_sites %}
                    {% for sid in all_sites %}
                      <div class="site-item {{ 'text-available' if sid in area.available else ('text-unavailable' if sid in area.unavailable else '') }}">
                        {{ "%02d"|format(sid|int) if sid|string|length <= 2 else sid }}
                      </div>
                    {% endfor %}
                  {% else %}
                    <p style="color:#6c757d; font-style: italic;">해당 구역의 사이트 정보를 찾을 수 없습니다.</p>
                  {% endif %}
                </div>
              </div>
            {% endfor %}

          {% elif selected_camp_key == 'busan_port' %}
            {# ---- 부산항 ---- #}
            {% set labels = {'auto':'오토 사이트','deck':'데크 사이트'} %}
            {% set totals = {'auto':16,'deck':24} %}
            {% for key in ['auto','deck'] %}
              <div class="area-container">
                <h3 class="area-title">{{ labels[key] }} (총 {{ totals[key] }}개)</h3>
                <p style="color:#6c757d; font-size:14px; margin:6px 2px 0;">
                  실시간 잔여 좌석은 예약 페이지에서 확인하세요.
                </p>
              </div>
            {% endfor %}

          {% elif selected_camp_key == 'gudeok' %}
            {# ---- 구덕 ---- #}
            {% set area = camp.areas['deck'] %}
            {% set group_defs = [
              {'label':'1 야영장','sites':['1-1','1-2']},
              {'label':'2 야영장','sites':['2-1','2-2','2-3','2-4']},
              {'label':'3 야영장','sites':['3-1','3-2','3-3']},
              {'label':'4 야영장','sites':['4-1','4-2','4-3']},
              {'label':'5 야영장','sites':['5-1','5-2','5-3','5-4']},
              {'label':'6 야영장','sites':['6-1','6-2']}
            ] %}
            {% for grp in group_defs %}
              {% set ns = namespace(av=0) %}
              {% for sid in grp.sites %}
                {% if sid in area.available %}{% set ns.av = ns.av + 1 %}{% endif %}
              {% endfor %}
              <div class="area-container">
                <h3 class="area-title">{{ grp.label }} (잔여: {{ ns.av }}개 / {{ grp.sites|length }}개)</h3>
                <div class="site-list">
                  {% for sid in grp.sites %}
                    {% set status_class = 'text-available' if sid in area.available else ('text-unavailable' if sid in area.unavailable else '') %}
                    <div class="site-item {{ status_class }}">{{ sid }}</div>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}

          {% else %}
            <p>표시할 캠핑장 정보가 없습니다.</p>
          {% endif %}

        {% endif %} {# camp.error else 종료 #}
      </div>
    {% endfor %}

    {% endif %} {# selected_camp_key == 'all' 종료 #}


    <script>
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0'); 
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        function setTodayAndSubmit() {
            document.getElementById('resdate').value = formatDate(new Date());
            document.getElementById('dateForm').submit();
        }
        function moveDate(dayChange) {
            const input = document.getElementById('resdate');
            const [yy, mm, dd] = input.value.split('-').map(v=>parseInt(v,10));
            const dt = new Date(yy, mm-1, dd);
            dt.setDate(dt.getDate() + dayChange);
            input.value = formatDate(dt);
            document.getElementById('dateForm').submit();
        }
        function openReservationLink() {
            const key = document.getElementById('campTabInput').value;
            const d = document.getElementById('resdate').value;
            let url_base;
            if (key === 'daejeo') {
                url_base = "https://www.daejeocamping.com/reservation/real_time?resdate=";
            } else if (key === 'hwamyeong') {
                url_base = "https://hwamyungcamping.com/reservation/real_time?resdate=";
            } else if (key === 'yeongdo') {
                window.open("https://www.yeongdo.go.kr/marinocamping/00003/00015/00028.web", "_blank"); return;
            } else if (key === 'busan_port') {
              window.open("https://www.busanpa.com/redevelopment/Board.do?mCode=MN0082", "_blank"); 
              return;
            } else if (key === 'gudeok') {
                window.open("https://gudeok.go.kr/rent_camp01.php", "_blank"); return;

            } else { // samnak 등
                url_base = "https://www.nakdongcamping.com/reservation/real_time?resdate=";
            }
            const reservationUrl = url_base + d + "&schGugun=1&price=0&bagprice=2000&allprice=0&percnt=0&g-recaptcha-response=";
            window.open(reservationUrl, '_blank');
        }
        function switchCamp(campKey) {
            document.getElementById('campTabInput').value = campKey;
            document.getElementById('dateForm').submit();
        }
    </script>
    <!-- 후원하기 섹션 -->
    <section class="donate-wrap">
      <div class="donate-card">
        <h2 class="donate-title">후원하기</h2>
        <p class="donate-desc">
          도움이 되셨다면 커피 한 잔 후원해 주세요 ☕️<br>
          카카오 페이로 안전하게 송금하실 수 있어요.
        </p>
        <div class="donate-actions">
          <!-- 🔗 카카오페이 송금 링크: 실제 복사한 링크로 교체 -->
          <a class="donate-button" href="https://qr.kakaopay.com/Ej8wCmrfN" target="_blank" rel="noopener noreferrer">
            카카오 페이로 송금하기
          </a>
        </div>

        <!-- QR (데스크톱/태블릿에서 특히 유용) -->
        <div class="donate-qr">
          <img src="{{ url_for('static', filename='qrcode_donation.png') }}" alt="카카오페이 송금 QR" />
          <div class="donate-qr-caption">휴대폰 카메라로 QR을 스캔해 주세요</div>
        </div>
      </div>
    </section>
    <!-- 예: 반응형 배너 (가로 320 x 세로 100) -->
    <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit = "DAN-WPxG6Yasp5xS2m0G"
    data-ad-width = "300"
    data-ad-height = "250"></ins>
    <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
    <div class="footer">All rights reserved by 바름 미디어</div>
</body>
</html>
